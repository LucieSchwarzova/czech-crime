//@codekit-append "Config.js" 
//@codekit-append "DummyData.js" 
//@codekit-append "Preloader.js" 
//@codekit-append "Popup.js" 
//@codekit-append "model/DataUtil.js" 
//@codekit-append "model/DataProxy.js" 
//@codekit-append "homepage/Autocomplete.js" 
//@codekit-append "homepage/Infobox.js" 
//@codekit-append "homepage/Timeline.js" 
//@codekit-append "homepage/SingleDate.js" 
//@codekit-append "homepage/TimelineActiveArea.js" 
//@codekit-append "homepage/FilterBox.js" 
//@codekit-append "homepage/CrimeTypesBox.js" 
//@codekit-append "homepage/DynamicRange.js" 
//@codekit-append "homepage/Legend.js" 
//@codekit-append "homepage/DateModel.js" 
//@codekit-append "homepage/DateRange.js" 
//@codekit-append "homepage/ZoomControl.js" 
//@codekit-append "homepage/Homepage.js" 
//@codekit-append "homepage/Arc.js" 
//@codekit-append "porovnani/PorovnaniSelectBox.js" 
//@codekit-append "porovnani/PorovnaniTable.js"
//@codekit-append "porovnani/RankStepper.js"
//@codekit-append "Porovnani.js"
//@codekit-append "tabulky/RankingSelectBox.js"
//@codekit-append "tabulky/RankingsTable.js"
//@codekit-append "tabulky/TypesTable.js"
//@codekit-append "tabulky/TrendGraphPopups.js"
//@codekit-append "tabulky/Trend.js"
//@codekit-append "Tabulky.js"
//@codekit-append "ContactForm.js" 
//@codekit-append "LogIn.js" 
//@codekit-append "Navigator.js" 
//@codekit-append "AboutApplication.js" 
//@codekit-append "vypis/Vypis.js" 
//@codekit-append "MapDetailOverlay.js" 
//@codekit-append "MapLayerOverviewPopUp.js" 
//@codekit-append "MapLayer.js" 
//@codekit-append "Map.js"   
//@codekit-append "tests/Tester.js" 
//@codekit-append "Application.js" 
//@codekit-append "plugins.js"
//@codekit-append "script.js"
/* **********************************************
     Begin Config.js
********************************************** *//* Author:
	zdenek.hynek@gmail.com
*/function SingleDate(e,t){var n=this;this.element=e;this.dateChangeCallback=t;this.months=this.element.find(".month li");this.years=this.element.find(".year li");this.years.on("click",function(){n.onYearClick(this)});this.months.on("click",function(){n.onMonthClick(this)});var r=this.element.find("li");r.on("mouseover",this.onLiMouseOver).on("mouseout",this.onLiMouseOut)}function PorovnaniSelectBox(e,t){this.element=e;this.options=this.element.find("option");this.rankStepper=null;this.selectedId=-1;var n=this;this.element.on("change",function(){var e=$(this).val();selectedOption=n.options.filter("[value='"+e+"']");n.rankStepper.setValue(selectedOption.data("rank"));n.selectedId=selectedOption.data("area");t.onChange&&t.onChange.apply(n,[n.selectedId])})}function PorovnaniTable(e){this.element=e;this.rows=this.element.find("section.table table tr");this.data=null;this.index=0;this.maxIndexValue=0;this.customRow=this.rows.last();this.customRow.hide()}function RankStepper(e,t,n){this.element=e;this.selectBox=t;this.arrowUp=null;this.arrowDown=null;this.p=null;this.min=1;this.max=10;this.opts=n;var r=this;r.p=r.element.find("p");r.arrowUp=r.element.find(".rankUp");r.arrowDown=r.element.find(".rankDown");r.arrowUp.on("click",function(e){e.preventDefault();r.update("up")});r.arrowDown.on("click",function(e){e.preventDefault();r.update("down")})}function RankingSelectBox(e,t){this.element=e;this.options=this.element.find("option");this.selectedType=null;this.opts=t;var n=this;this.element.on("change",function(){n.changeHandler(this)})}function sortCompleteCallbackrankingTable(){RankingsTable.renumberRows()}function getURLParameter(e){return decodeURIComponent((location.search.match(RegExp("[?|&]"+e+"=(.+?)(&|$)"))||[,null])[1])}function getHash(){var e=window.location.hash;return e.substring(1)}function Test(e){this.type=e.type?e.type:"getArea";this.zoomLevel=e.zoomLevel?e.zoomLevel:null;this.timeFrom=e.timeFrom?e.timeFrom:null;this.timeTo=e.timeTo?e.timeTo:null;this.filters=e.filters?e.filters:null;this.id1=e.id1?e.id1:"";this.id2=e.id2?e.id2:"";this.interval=e.interval?e.interval:1e3;this.crimeTypes=e.crimeTypes?e.crimeTypes:null;this.completeCallback=e.completeCallback}function getElementsByClass(e,t,n){t==null&&(t=document);n==null&&(n="*");var r=new Array,s=t.getElementsByTagName(n),o=" "+e+" ";for(i=0,j=0;i<s.length;i++){var u=" "+s[i].className+" ";u.indexOf(o)!=-1&&(r[j++]=s[i])}return r}var Config={GOOGLE_MAPS_API_KEY:"AIzaSyB7MKCUedN9wCarH7GOll39ffkYwZjyHbk",GOOGLE_SENSOR:!1,map:{wrapperId:"mapWrapper"},navigation:{wrapperId:"pagesNav",mainContentId:"main"}},DummyData={graph:{country:"Česká republika",index:{name:"index kriminality",val:"230"},solv:{col:"#555555",val:2e4},com:{col:"#444444",val:32e3},trend:10,name:"Česká republika",data:{violent:{name:"Násilné činy",solv:{col:"#def5af",val:2e3},com:{col:"#d2f193",val:3200}},moral:{name:"Mravnostní činy",solv:{col:"#c6e2a5",val:2e3},com:{col:"#b7dc8e",val:8e3}},burglary:{name:"Krádeže vloupání",solv:{col:"#b3d0a2",val:600},com:{col:"#9cc384",val:5e3}},theft:{name:"Krádeže prosté",solv:{col:"#9fbd9b",val:500},com:{col:"#89b084",val:3e3}},property:{name:"Ostatní majetkové činy",solv:{col:"#8db09a",val:1e3},com:{col:"#719d82",val:3500}},other:{name:"Ostatní činy",solv:{col:"#8db09a",val:800},com:{col:"#5b867c",val:3200}},rest:{name:"Zbývající činy",solv:{col:"#678d90",val:900},com:{col:"#446e7a",val:2500}},economic:{name:"Hospodářské činy",solv:{col:"#537e8f",val:1200},com:{col:"#2c5a71",val:3200}},military:{name:"Vojenské činy",solv:{col:"#406b8b",val:1400},com:{col:"#12466d",val:3100}}}},timeline:{data:[{date:"Leden 2010",abs:"-",index:300},{date:"Únor 2010",abs:"-",index:200},{date:"Březen 2010",abs:"-",index:160},{date:"Duben 2010",abs:"-",index:400},{date:"Květen 2010",abs:"-",index:300},{date:"Červen 2010",abs:"-",index:200},{date:"Červenec 2010",abs:"-",index:560},{date:"Srpen 2010",abs:"-",index:500},{date:"Září 2010",abs:"-",index:200},{date:"Říjen 2010",abs:"-",index:100},{date:"Listopad 2010",abs:"-",index:200},{date:"Prosinec 2010",abs:"-",index:100},{date:"Leden 2011",abs:"-",index:300},{date:"Únor 2011",abs:"-",index:200},{date:"Březen 2011",abs:"-",index:160},{date:"Duben 2011",abs:"-",index:400},{date:"Květen 2011",abs:"-",index:300},{date:"Červen 2011",abs:"-",index:200},{date:"Červenec 2011",abs:"-",index:560},{date:"Srpen 2011",abs:"-",index:500},{date:"Září 2011",abs:"-",index:200},{date:"Říjen 2011",abs:"-",index:100},{date:"Listopad 2011",abs:"-",index:200},{date:"Prosinec 2011",abs:"-",index:100},{date:"Leden 2012",abs:"-",index:300},{date:"Únor 2012",abs:"-",index:200},{date:"Březen 2012",abs:"-",index:160},{date:"Duben 2012",abs:"-",index:400}]}},Preloader={DEFAULT_TEXT:texts["Nahrávání dat..."],element:null,darkOverlay:null,init:function(){this.darkOverlay=$(".preloaderBack");this.element=$("#ajax-spinner")},show:function(e){this.element||this.init();this.element.show();e?this.element.text(e):this.element.text(this.DEFAULT_TEXT);this.darkOverlay.show()},hide:function(){if(this.element&&this.darkOverlay){this.element.hide();this.darkOverlay.hide()}}},Popup={DEFAULT_TEXT:texts["Nahrávání dat..."],element:null,darkOverlay:null,init:function(){this.darkOverlay=$('<div class="popupBack"></div>').appendTo("body");this.element=$('<div id="ajax-spinner">'+texts["Nahrávání dat..."]+"</div>").appendTo("body").css({position:"absolute",left:"50%",top:"50%"})},show:function(e){this.element||this.init();this.element.show();e?this.element.text(e):this.element.text(this.DEFAULT_TEXT);this.darkOverlay.show()},hide:function(){if(this.element&&this.darkOverlay){this.element.hide();this.darkOverlay.hide()}}},DataUtil={checkDataSanity:function(e){var t=!0,n=e.FoundSum,r=e.SolvedSum;n==0&&n<r&&(t=!1);return t},checkCorrectData:function(e){var t=!0;isNaN(e.index)&&(t=!1);return t},formatIndex:function(e){return Math.round(e*10)/10},getMonthFromIndex:function(e){switch(e){case 1:index=texts.Leden;break;case 2:index=texts["Únor"];break;case 3:index=texts["Březen"];break;case 4:index=texts.Duben;break;case 5:index=texts["Květen"];break;case 6:index=texts["Červen"];break;case 7:index=texts["Červenec"];break;case 8:index=texts.Srpen;break;case 9:index=texts["Září"];break;case 10:index=texts["Říjen"];break;case 11:index=texts.Listopad;break;case 12:index=texts.Prosinec}return index},addSpaces:function(e){e+="";var t=e.split("."),n=t[0],r=t.length>1?"."+t[1]:"",i=/(\d+)(\d{3})/;while(i.test(n))n=n.replace(i,"$1 $2");return n+r},getColorForCrimeType:function(e){var t=["#444","#555"];switch(e){case"101-106":t=["#dc55a9","#e788c3"];break;case"201":t=["#b8529e","#cd86bb"];break;case"141,142,143,151,161,171,173,181,611,612,614":t=["#925092","#b385b3"];break;case"131,132":t=["#6c4d87","#9883ab"];break;case"371,373":t=["#47497c","#7f80a4"];break;case"372":t=["#214671","#647e9c"];break;case"431":t=["#235570","#65889b"];break;case"433,434":t=["#467678","#7e9fa1"];break;case"435":t=["#69937d","#96b4a4"];break;case"635,641,642,643":t=["#8db485","#afcbaa"];break;case"771":t=["#aed28b","#c6e0ae"];break;case"101-903":t=["#444444","#555555"];break;case"-999":t=["#d1f092","#e3f6be"];break;default:t=["#ffde00","#ffeb66"]}return t},formatTitle:function(e){e=e.replace("OOP ","");e=e.replace("MOP ","");e=e.replace("OŽP ","");e=e.replace("ÚO ","");e=e.replace("OŘP ","");return e},shortenText:function(e,t,n){if(e)return e.length>n?e.substr(0,n)+t:e}},DataProxy={NAMES_INDEXES_KEYWORD:"namesAndIndexes",cachedData:[],areasTotalData:[],getNamesAndIndexes:function(e){var t=this,n=this.getCachedData(this.NAMES_INDEXES_KEYWORD);if(n){this.areasTotalData=n.namesAssocArray;return n.array}var r=this.callAjax({name:"findNamesIndexesForIdsRange"},!1),i=[],s=r.slice(0);s.sort(function(e,t){return t.I-e.I});var o=[],u=s.length;for(var a=0;a<u;a++){var f=s[a];o[f.Name]=a}this.areasTotalData=[];for(var l=0;l<u;l++){f=r[l];rank=o[f.Name]+1;r[l].Rank=rank;r[l].Name=DataUtil.formatTitle($.trim(r[l].Name));if(rank==1){var c=r[l].I;r.maxValue=c}r[l].I<0&&(r[l].I=0);this.areasTotalData[r[l].Code]=r[l]}t.storeCachedData(t.NAMES_INDEXES_KEYWORD,{array:r,namesAssocArray:this.areasTotalData});return r},getDataForArea:function(e,t){var n=this,r=Application.currentKey(),i=this.getCachedData(e);if(i){t.apply(this,[i]);Preloader.hide();return}var s=this.callAjax({name:"getDataForArea",area:e},!1);t.apply(this,[s]);n.storeCachedData(e,s,r);Preloader.hide()},getAllCrimeTypesForArea:function(e,t){var n=this,r=Application.currentKey(),i=this.getCachedData("getAllCrimeTypesForArea-"+e);if(i){t.apply(this,[i]);Preloader.hide();return}var s=this.callAjax({name:"getAllCrimeTypesForArea",area:e},!1);t.apply(this,[s]);n.storeCachedData("getAllCrimeTypesForArea-"+e,s,r);Preloader.hide()},getDataForAreaOverview:function(e,t){var n=this.areasTotalData[e];n||(n={FoundSum:0,I:0});t.apply(this,[{value:n.FoundSum,index:n.I}])},getRankingsForCrimeType:function(e){var t=this.callAjax({name:"getRankingsForCrimeType",crimeType:e},!1);return t},getGraphData:function(e,t){var n=this.callAjax({name:"getGraphData",area:e,minTime:minTime,maxTime:maxTime},!1);t.apply(Trend,[n])},storeCachedData:function(e,t,n){n||(n=Application.currentKey());this.cachedData[n]||(this.cachedData[n]=[]);this.cachedData[n][e]=t},loadMapStyles:function(e){var t=this,n=this.getNamesAndIndexes();return n},getTimeline:function(){var e=this.callAjax({name:"getTimeline",minTime:minTime,maxTime:maxTime},!1);return e},loadDamage:function(){if(Application.zoomLevel==2)return"NaN";var e=loadDamage(Application.selectedUnit),t=parseFloat(e);t=Math.round(t/1e3)*1e3;t/=1e6;var n=String(t).replace(".",",");return n},getAreaGeometry:function(e,t){if(t)this.callAjax({name:"getAreaGeometry",complete:e},t);else{var n=this.callAjax({name:"getAreaGeometry"},t);e.apply(MapLayer,[n])}},getCachedData:function(e){return this.cachedData[Application.currentKey()]&&this.cachedData[Application.currentKey()][e]?this.cachedData[Application.currentKey()][e]:null},callAjax:function(e,t){var n="?do="+e.name,r=this,i;$.ajax({async:t,type:"GET",dataType:"json",data:{area:e.area,zoomLevel:Application.zoomLevel,timeFrom:Application.timeFrom,timeTo:Application.timeTo,language:appLanguage,minTime:e.minTime?e.minTime:null,maxTime:e.maxTime?e.maxTime:null,crimeTypes:e.filters?e.filters:Application.filtersString(),crimeType:e.crimeType?e.crimeType:null},url:n,success:function(t){i=t;if(!i){alert(texts["Máme problém s načtením dat, zkuste prosím zvolit jiné období nebo územní jednotku."]);Preloader.hide()}e.complete&&e.complete.apply(r,[i])},error:function(e){console.log("error: "+n);console.log(e);alert(texts["Máme problém s načtením dat, zkuste prosím zvolit jiné období nebo územní jednotku."]);Preloader.hide()},progress:function(){console.log("standard progress callback")}});if(!t)return i}},AutoComplete=function(e){this.callbacks={};this.opts=e;this.plugin=null;this.element=$(".autoCompleteBox");this.origHeight=this.element.find(".content").outerHeight();var t=this;this.element.find(".hideBtn").on("click",function(){var e=$(this);t.element.find(".content").slideToggle(300);$(".contact").hide();e.toggleClass("hideBtnDown");e.parent().toggleClass("noBorder");var n=t.origHeight,r=e.hasClass("hideBtnDown")?n:-n;t.collapsed=r>0?!0:!1;Homepage.updateLayout(r,t)})};AutoComplete.prototype={init:function(){var e=this;this.plugin=$("#"+this.opts.autoCompleteId).geocomplete().bind("geocode:result",function(t,n){e.onGeocodeResult(t,n)}).bind("geocode:error",function(t,n){e.onGeocodeError(t,n)}).bind("geocode:multiple",function(t,n){e.onGeocodeMultiple(t,n)})},onGeocodeResult:function(e,t){if(this.callbacks.hasOwnProperty("onGeocodeResult")){var n=t.geometry.location,r=t.geometry.viewport;this.callbacks.onGeocodeResult.apply(this,[n,r])}},onGeocodeError:function(e,t){console.log("AutoComplete.js: geocoding ERROR: "+t)},onGeocodeMultiple:function(e,t){console.log("AutoComplete.js: geocoding Multiple: "+t.length+" results found")}};var InfoBox={dummyData:{title:"title",content:"content"},selector:".homepageInfoBox",headerUnit:null,index:null,damage:null,damageValue:null,title:null,rank:null,total:null,officers:null,element:null,origHeight:null,collapsed:!1,init:function(){var e=this;e.element=$(e.selector);e.origHeight=e.element.find(".content").outerHeight();e.headerUnit=e.element.find(".headerWrapper").find("h1");e.title=e.element.find("#county");e.index=e.element.find("#ic");e.total=e.element.find("#totalcrime");e.officers=e.element.find("#officers");e.damage=e.element.find("#damage");e.rank=e.element.find(".rank");e.element.find(".hideBtn").on("click",function(){var t=$(this);e.element.find(".content").slideToggle(300);$(".contact").hide();t.toggleClass("hideBtnDown");t.parent().toggleClass("noBorder");var n=e.origHeight,r=t.hasClass("hideBtnDown")?n:-n;e.collapsed=r>0?!0:!1;Homepage.updateLayout(r,e)});e.element.find(".contactBtn").on("click",function(){ContactForm.show();MapDetailOverlay.close();_gaq.push(["_trackEvent","contactBtn",Application.currentKey()])});area!=""&&Application.updateSelectedUnit(area)},update:function(e){var t=this;appLanguage=="en"&&Application.zoomLevel==0?t.title.html("Czech republic"):t.title.html(DataUtil.shortenText(DataUtil.formatTitle(e.name),"...",18));var n=e.index;isNaN(n)?t.index.addClass("noData"):t.index.removeClass("noData");t.index.html(DataUtil.addSpaces(DataUtil.formatIndex(n)));t.total.html(DataUtil.addSpaces(e.foundSum));var r=!0,i=300,s=500,o=Application.filters.length;for(var u=0;u<len;u++){var a=Application.filters[u];if(a!="373,373"&&a!="433,434"&&(a<i||a>s)){r=!1;break}if(a=="101-106"||a=="131,132"||a=="141,142,143,151,161,171,173,181,611,612,614"||a=="635,641,642,643"){r=!1;break}}if(r){var f=DataUtil.addSpaces(e.damage)+" Kč";this.damage.html(f);this.damage.removeClass("noData")}else{this.damage.html(texts["Data nejsou k dispozici"]);this.damage.addClass("noData")}var l=1;if(Application.zoomLevel>0){l=t.findRankById(e.id);l>99?t.rank.addClass("longRank"):t.rank.removeClass("longRank")}t.rank.html(DataUtil.addSpaces(l))},findRankById:function(e){var t=DataProxy.getCachedData(DataProxy.NAMES_INDEXES_KEYWORD);if(t&&t.array){var n=0;$.each(t.array,function(t,r){if(r.Code==e){n=r.Rank;return!1}});return n}return 0},toggleNaNForDamage:function(e){if(e){this.damage.html(texts["Data nejsou k dispozici"]);this.damage.addClass("noData")}else{this.damage.html(this.damageValue);this.damage.removeClass("noData")}},updateZoomLevel:function(e){var t="";e==0?t=texts["ČR"]:e==1?t=texts.KRAJ:e==2?t=texts["ÚZEMNÍ ODBOR"]:e==3&&(t=texts["OBVODNÍ ODDĚLENÍ"]);this.headerUnit.text(t);this.clearValues(e)},clearValues:function(e){var t=this,n="-",r="";e==1?r=texts["Vyber kraj v mapě"]:e==2?r=texts["Vyber odbor v mapě"]:e==3&&(r=texts["Vyber oddělení v mapě"]);t.title.html(r);t.index.html(n);t.total.html(n);t.damage.html(n);t.rank.removeClass("longRank");t.rank.html(0)}},Timeline={dummyData:{title:"title",content:"content"},element:null,lis:null,dataView:null,data:null,range:null,leftArrow:null,rightArrow:null,detailBox:null,widthForBar:null,firstDate:null,secondDate:null,init:function(){var e=this;e.element=$(".homepageTimeline");e.dataView=e.element.find(".dataView");e.leftArrow=e.element.find(".leftArrow");e.rightArrow=e.element.find(".rightArrow");e.leftArrow.on("click",function(){e.handleArrows("forward")});e.rightArrow.on("click",function(){e.handleArrows("backward")});data=DataProxy.getTimeline();e.update(data);e.detailBox=$("<div class='detailBox'><div class='content'><h2>jmeno</h2><p>test</p></div><div class='bottom'></div></div>");e.element.append(e.detailBox);var t=e.dataView.find(".data").width()-e.leftArrow.width()-e.rightArrow.width()+5;TimelineActiveArea.init(20,e.leftArrow.width(),t);$(window).on("resize",e.resize);e.element.on("mouseover",TimelineActiveArea.show).on("mouseout",TimelineActiveArea.hide);e.dataView.show()},update:function(e){var t=this;t.data=e;var n=t.dataView.find("ol").empty(),r=t.getRange(t.data,"FoundSum"),i=r[1]-r[0],s=25,o=35,u=o-s,a=e.length,f=d3.scale.linear().domain([r[0],r[1]]).range([s,o]),l=t.getAvailableWidth();$.each(e,function(e,n){var a=t.convertMonthsToLanguage(n.Date);n.date=a;var l=$("<li data-time-lookup='"+n.FK_Time_Lookup+"'><div class='fill'></div><div class='value'></div></li>"),c=l.find(".value"),h=l.find(".fill");t.dataView.find("ol").append(l);var p=s,d=n.FoundSum,v=d-r[0],m=v/i;p+=m*u;var g=o-f(n.FoundSum);c.css({height:p});h.css({height:g});l.css({marginTop:0});l.data("values",n);l.on("mouseover",t.displayBox).on("mouseout",t.hideBox).on("click",t.chooseSingleMonth)});t.lis=t.dataView.find("li");t.sizeBarsToWidth(l)},setDates:function(e,t){var n=this,r=1e6,i=0,s;n.timeFrom=e;n.timeTo=t;n.lis.removeClass("active");$.each(n.lis,function(n,o){var u=$(o),a=u.data("values");s=u.position().left;if(!a)return;var f=a.FK_Time_Lookup;if(f>=e&&f<=t){u.addClass("active");r=Math.min(s,r);i=Math.max(s+u.width(),i)}else u.removeClass("active")});r+=n.leftArrow.width();i+=n.leftArrow.width();TimelineActiveArea.update(r,i-r)},chooseSingleMonth:function(){var e=$(this),t=e.data("values"),n=t.FK_Time_Lookup;DateModel.setDate(n,n)},handleArrows:function(e){var t=this;e!="forward"&&e=="backward"},displayBox:function(e,t){var n=Timeline,r=$(e.target).parent();r.prop("tagName")!="LI"&&(r=$(e.target).parent());var i=r.data("values");if(i==null)return;n.detailBox.show();n.detailBox.find("h2").text(i.date);n.detailBox.find("p").text(DataUtil.addSpaces(i.FoundSum)+texts[" trestných činů"]);if(!t){r.addClass("highlight");r.hasClass("active")?n.detailBox.find(".content").removeClass("inactive"):n.detailBox.find(".content").addClass("inactive")}else n.detailBox.find(".content").removeClass("inactive");var s=r.offset(),o=n.element.offset();n.detailBox.css({top:o.top-146,left:s.left-45+Timeline.widthForBar/2})},displayBoxWhileDragging:function(e){var t=this,n=t.lis.length,r=t.dataView.offset();for(var i=0;i<n;i++){var s=$(t.lis[i]),o=s.offset().left-r.left+s.width();if(o>e){t.displayBox({target:s.find("div").eq(0)},!0);break}}},hideBox:function(e){var t=Timeline,n=$(e.target).parent();n.removeClass("highlight");t.detailBox.hide()},getRange:function(e,t){var n=1e6,r=0;$.each(e,function(e,i){var s=i[t];n=Math.min(n,s);r=Math.max(r,s)});return[n,r]},sliderMoved:function(e,t,n){var r=this,i=r.lis.length,s,o;r.detailBox.hide();for(var u=0;u<i;u++){var a=r.lis.eq(u),f=a.data("values"),l=f.FK_Time_Lookup;position=a.position().left+r.leftArrow.width()+Timeline.widthForBar/2;if(n=="left"){if(position>=e&&!s){DateModel.setDate(l);return}}else if(n=="right")if(position>=e+t-a.width()||u==i-1){DateModel.setDate(null,l);return}}},compareDates:function(e,t){var n=0;e.year>t.year?n=1:e.year<t.year?n=-1:e.month>t.month?n=1:e.month<t.month&&(n=-1);return n},getIndexForMonth:function(e){var t=-1;switch(e){case texts.Leden:t=0;break;case texts["Únor"]:t=1;break;case texts["Březen"]:t=2;break;case texts.Duben:t=3;break;case texts["Květen"]:t=4;break;case texts["Červen"]:t=5;break;case texts["Červenec"]:t=6;break;case texts.Srpen:t=7;break;case texts["Září"]:t=8;break;case texts["Říjen"]:t=9;break;case texts.Listopad:t=10;break;case texts.Prosinec:t=11}return t},convertMonthsToLanguage:function(e){var t=e.split(" "),n=t[0],r=texts[n];return r+" "+t[1]},getAvailableWidth:function(){var e=this,t=parseInt($(document).width()),n=parseInt(e.dataView.css("left")),r=parseInt(e.dataView.css("right"));return t-n-r-e.leftArrow.width()-e.rightArrow.width()},sizeBarsToWidth:function(e){var t=this,n=2,r=t.lis.length;t.widthForBar=Math.floor(e/r-2);$.each(t.lis,function(e,n){$(n).css({width:t.widthForBar})})},resize:function(){var e=Timeline;e.sizeBarsToWidth(e.getAvailableWidth());e.setDates(e.timeFrom,e.timeTo)}};SingleDate.prototype={setDate:function(e){var t=e-e%12,n=this.years.filter("[data-time-lookup="+t+"]");this.updateMonthsToYear(t);var r=this.months.filter("[data-time-lookup="+e+"]");this.months.removeClass("selected");this.years.removeClass("selected");r.addClass("selected");n.addClass("selected")},updateMonthsToYear:function(e){$.each(this.months,function(t,n){var r=$(this);r.attr("data-time-lookup",e);e<minTime||e>maxTime?r.addClass("unavailable"):r.removeClass("unavailable");e++})},onYearClick:function(e){var t=$(e),n=t.attr("data-time-lookup");this.updateMonthsToYear(n);var r=this.months.filter(".selected"),i=parseInt(r.attr("data-time-lookup"));i<minTime&&(i=minTime);i>maxTime&&(i=maxTime);this.dateChangeCallback(i)},onMonthClick:function(e){var t=$(e);if(!t.hasClass("unavailable")){var n=t.attr("data-time-lookup");this.dateChangeCallback(n)}},onLiMouseOver:function(){var e=$(this);e.hasClass("unavailable")||e.addClass("active")},onLiMouseOut:function(){var e=$(this);e.hasClass("unavailable")||e.removeClass("active")}};var TimelineActiveArea={element:null,leftSlider:null,leftSliderStartOffset:null,rightSlider:null,rightSliderStartOffset:null,gap:10,minLeft:0,maxLeft:0,dragging:!1,init:function(e,t,n){var r=this;r.gap=e;r.element=$(".activeArea");r.leftSlider=r.element.find(".left");r.leftSliderStartOffset=r.leftSlider.offset().left;r.rightSlider=r.element.find(".right");r.rightSliderStartOffset=r.rightSlider.offset().left;r.minLeft=t;r.maxLeft=n;var i=0;r.handleSlider(r.leftSlider);r.handleSlider(r.rightSlider);r.element.hide()},handleSlider:function(e,t){var n=this,r=0;e.bind("dragstart",function(e){r=e.offsetX;n.dragging=!0}).bind("drag",function(t){var i=t.offsetX-r,s=parseInt(n.element.css("left"));width=parseInt(n.element.css("width"));newLeft=s+i,newWidth=width+i;leftSlider=e==n.leftSlider;if(leftSlider){newLeft<n.minLeft&&(newLeft=n.minLeft);if(width<Timeline.widthForBar)return}else if(newWidth<Timeline.widthForBar||newLeft+newWidth>n.maxLeft)return;if(leftSlider){newWidth=width-i;n.element.css({left:newLeft,width:newWidth});Timeline.displayBoxWhileDragging(s)}else{n.element.css({width:newWidth});Timeline.displayBoxWhileDragging(s+newWidth)}r=t.offsetX}).bind("dragend",function(t){var r=e==n.leftSlider?"left":"right";Timeline.sliderMoved(n.element.position().left,n.element.width(),r);n.dragging=!1;_gaq.push(["_trackEvent","sliderMoved",Application.currentKey()])})},update:function(e,t){var n=this;n.element.css({left:e});n.element.width(t)},hide:function(){TimelineActiveArea.dragging||TimelineActiveArea.element.hide()},show:function(){TimelineActiveArea.element.show()}},FilterBox={selector:".homepageFilterBox",content:null,firstClick:!0,lis:null,customLi:null,customLiInput:null,hideBtn:null,forcedTurnedOff:null,inputs:null,element:null,data:null,origHeight:null,allChecked:!0,oneChecked:!1,activeType:null,collapsed:!1,init:function(){var e=this;e.element=$(e.selector);e.content=e.element.find(".content");e.data=DummyData;e.origHeight=e.element.find(".content").outerHeight();e.hideBtn=e.element.find(".hideBtn");e.hideBtn.on("click",function(){var t=$(this);e.content.slideToggle(300);t.toggleClass("hideBtnDown");t.parent().toggleClass("noBorder");var n=e.origHeight,r=t.hasClass("hideBtnDown")?n:-n;e.collapsed=r>0?!0:!1;Homepage.updateLayout(r,e)});e.lis=e.element.find("li");e.lis.on("mouseover",e.onLiMouseover);e.lis.on("mouseout",e.onLiMouseout);e.customLi=e.lis.filter(".custom");e.customLiInput=e.customLi.find("input");var t=e.customLi.find("p");t.on("click",function(){CrimeTypesBox.toggleVisibility()});e.forcedTurnedOff=[];e.inputs=e.element.find("input");e.inputs.checkbox({empty:"images/empty.png"});e.inputs.on("change",e.handleInput)},handleInput:function(){var e=FilterBox,t=this!=FilterBox?$(this):e.customLiInput,n=t.parent(),r=n.data("crime-type"),i=t.attr("checked");if(r==-1){CrimeTypesBox.show();t.attr("checked",!1);return}var t=$(this);e.allChecked?$.each(e.inputs,function(e,t){var n=$(t),i=n.parent().data("crime-type");r!=i?n.attr("checked",!1):n.attr("checked",!0)}):e.oneChecked&&!t.attr("checked")&&$.each(e.inputs,function(e,t){var n=$(t),r=n.parent().data("crime-type");if(r!="-1"){n.attr("checked",!0);Porovnani.toggleTableRowVisibility(r,!0)}});_gaq.push(["_trackEvent","filters",Application.currentKey()]);Application.filters=new Array;var s=0,o=0;$.each(e.inputs,function(t,n){var u=$(n),a=u.parent(),f=a.data("crime-type").toString();if(f!=r)if(i){var l=e.checkFilterCollision(f.toString(),r.toString());if(l&&u.attr("checked")){u.attr("checked",!1);e.forcedTurnedOff.push(f)}}else{var l=e.checkFilterCollision(f.toString(),r.toString());if(l){var c=$.inArray(f,e.forcedTurnedOff);if(c>-1){e.forcedTurnedOff.splice(c,1);u.attr("checked",!0)}}}if(u.attr("checked")){Application.filters.push(f);u.parent().removeClass("inactive");u.parent().hasClass("custom")||s++;o++}else{u.parent().addClass("inactive");u.parent().removeClass("active")}});e.allChecked=s==e.inputs.length-1?!0:!1;e.oneChecked=o==1?!0:!1;Application.updateFilters()},checkFilterCollision:function(e,t){var n=!1,r="101-106";if(e!=r&&t!=r){if(e.indexOf(t)>=0||t.indexOf(e)>=0)n=!0}else{var i=e==r?e:t,s=e==i?t:e,o=i.split("-"),u=parseInt(o[0]),a=parseInt(o[1]),f=parseInt(s);f>=u&&f<=a&&(n=!0)}return n},update:function(e){var t=this,n=e.filterBoxCrimes;n&&$.each(t.lis,function(e,r){var i=$(r);$span=i.find("span.val"),crimeType=i.data("crime-type");if(crimeType!=-1)if(n.hasOwnProperty(crimeType)){var s=n[crimeType];t.updateSpan($span,s.FoundSum)}else t.updateSpan($span,0)});MapDetailOverlay.isDisplayed()&&MapDetailOverlay.display(e)},updateSpan:function(e,t){if(e){e.text(DataUtil.addSpaces(Math.max(0,t)));e.hasClass("with-back")&&e.removeClass("with-back")}},slideUp:function(e){var t=this;t.element.css("top","-="+e)},getUncheckedFilters:function(){var e=this,t=[];$.each(e.inputs,function(e,n){var r=$(n);r.attr("checked")||t.push(r.attr("name"))});return t},switchToPorovnani:function(){Navigator.boxWrapper.show();Navigator.boxWrapper.removeClass("trend-box-wrapper");this.element.show();this.element.addClass("porovnaniFilterBox");this.element.removeClass("trendFilterBox");this.toggleHideBtn(!1);setTimeout(function(){Homepage.resizeScrollbar()},250)},switchToMapa:function(){Navigator.boxWrapper.removeClass("trend-box-wrapper");Navigator.boxWrapper.show();this.element.show();this.element.removeClass("porovnaniFilterBox");this.element.removeClass("trendFilterBox");this.toggleHideBtn(!0);setTimeout(function(){Homepage.resizeScrollbar()},50)},switchToTabulky:function(){Navigator.boxWrapper.removeClass("trend-box-wrapper");Navigator.boxWrapper.hide();this.element.hide();this.element.removeClass("removeFilterBox")},switchToTrend:function(){Navigator.boxWrapper.show();Navigator.boxWrapper.addClass("trend-box-wrapper");this.element.show();this.element.removeClass("porovnaniFilterBox");this.element.addClass("trendFilterBox");this.toggleHideBtn(!1);setTimeout(function(){Homepage.resizeScrollbar()},50)},updateZoomLevel:function(e){this.clearValues()},clearValues:function(){var e="-";this.element.find("span.val").text(e)},highlightType:function(e){this.activeType=this.lis.filter("[data-crime-type='"+e+"']");this.activeType.addClass("active")},dehighlightType:function(e){this.activeType&&this.activeType.removeClass("active")},onLiMouseover:function(){var e=$(this);if(e.hasClass("inactive"))return;FilterBox.lis.removeClass("active");e.addClass("active");var t=e.data("crimeType");Trend.highlightType(t)},onLiMouseout:function(){var e=$(this);if(e.hasClass("inactive"))return;if(!Trend.singleTypeMode||!Trend.singleTypeModeEnabled){e.removeClass("active");var t=e.data("crimeType");Trend.dehighlightType(t)}},enableForTrend:function(){this.lis.on("mouseover",self.onLiMouseover);this.lis.on("mouseout",self.onLiMouseout)},disableForTrend:function(){this.lis.off("mouseover",this.onLiMouseover);this.lis.off("mouseout",this.onLiMouseout)},updateCustomCrime:function(e,t){this.customLi.data("crime-type",e);var n=this.customLi.find("p");n.text(DataUtil.shortenText(t,"...",35));this.customLiInput.attr("checked")||this.customLiInput.attr("checked",!0);var r=this.customLi.find("input").get(0);this.handleInput.apply(r)},toggleHideBtn:function(e){e?this.hideBtn.show():this.hideBtn.hide()}},CrimeTypesBox={selector:".homepageCrimeTypesBox",content:null,element:null,jScrollApi:null,wasReinitialized:!1,init:function(){var e=this;e.element=$(e.selector);e.content=e.element.find(".content");e.lis=e.content.find("li");e.lis.on("click",e.onLiClick);e.element.find(".hideBtn").on("click",$.proxy(e.onHideBtnClick,this));e.element.find(".chosen-select").chosen({no_results_text:"Nic nenalezeno pro: "});e.input=e.element.find(".crime-types-search");e.input.on("change keyup paste",function(t){e.onCrimeSearch(this)});e.searchStyle=document.getElementById("search_style");e.content.jScrollPane();e.jScrollApi=this.content.data("jsp");e.jScrollApi.reinitialise()},onLiClick:function(){var e=$(this),t=e.text(),n=$(this).data("crime-type");if(!e.hasClass("unselectable")){Application.updateCustomCrime(n,t);CrimeTypesBox.hide()}},onCrimeSearch:function(e){var t=$(e),n=t.val();n==""?this.searchStyle.innerHTML="":this.searchStyle.innerHTML='.searchable:not([data-search-name*="'+t.val().toLowerCase()+'"]) { display: none; }';this.jScrollApi.reinitialise()},onHideBtnClick:function(){this.hide()},hide:function(){this.element.hide()},show:function(){this.element.show()},toggleVisibility:function(){if(this.element.is(":visible"))this.element.hide();else{this.element.show();if(!this.wasReinitialized){this.wasReinitialized=!0;this.jScrollApi.reinitialise()}}}},DynamicRange={ranges:null,classifyJenks:function(e,t,n){if(e==="undefined")return;typeof t=="undefined"&&(t=5);this.ranges=[];if(e.length>1)if(n>=1){var r=new geostats;r.setSerie(e);var i;if(n>20){var s=getURLParameter("stats");s=="jenks"?i=r.getJenks(t):i=r.getQuantile(t)}else i=r.getEqInterval(t);var o=r.ranges.length;for(var u=0;u<o;u++){var a=r.ranges[u],f=a.split("-");this.ranges.push(f)}this.ranges=r.ranges}else{var o=e.length;this.ranges.push("0 - 0");this.ranges.push(n+" - "+n);for(var u=2;u<t;u++)this.ranges.push("-")}else{this.ranges.push("0 - 0");this.ranges.push(n+" - "+n);for(var u=2;u<t;u++)this.ranges.push("-")}return this.ranges}},Legend={element:null,lis:null,val:null,selectedValue:0,ranges:null,init:function(){var e=this;e.element=$(".homepageLegendMain");e.lis=e.element.find("li");e.val=e.element.find(".value");e.lis.on("mouseover",function(){var t=$(this);t.addClass("active");var n=t.hasClass("last");e.updateValueText(t.text(),n)}).on("mouseout",function(){var t=$(this);t.removeClass("active");e.updateValueText(e.selectedValue)})},update:function(e){var t=this,n=t.getStepFromIndexValue(e.index);t.lis.removeClass("selected");t.selectedValue=t.lis.eq(n).addClass("selected").text();var r=n<t.lis.size()-1?!1:!0;t.updateValueText(t.selectedValue,r)},updateValueText:function(e,t){this.val.text(e)},updateRanges:function(e){var t=this,n=0;if(!t.lis)return;var r=e.length-1,i=10;$.each(e,function(e,n){var s=e<r?!1:!0,o=t.lis.eq(e);if(n!=0&&n!="-"){var u=n.split(" - ");u[0]=Math.round(u[0]*i)/i;u[1]=Math.round
(u[1]*i)/i;if(u[0]==u[1])value=u[0];else if(!s){var a=u[0],f=u[1];f>0&&(f-=.1);f=Math.round(f*i)/i;value=a!=f?DataUtil.addSpaces(a)+" - "+DataUtil.addSpaces(f):DataUtil.addSpaces(a)}else value=DataUtil.addSpaces(Math.round(u[0]*i)/i)+" - "+DataUtil.addSpaces(Math.round(parseFloat(u[1])*i)/i);o.text(value)}else o.text("-");o.data("range",n)});t.ranges=e},getStepFromIndexValue:function(e){var t=this,n=0,r=-1,i=t.lis.length;e=DataUtil.formatIndex(e);if(e>0)for(n=0;n<i;n++){var s=t.ranges[n],o=String(s).split(" - "),u=o[0],a=o[1],f=n+1==i?!0:!1;if(!f){if(u!=a){if(e>=u&&e<a){r=n;break}}else if(e>=u&&e<=a){r=n;break}}else if(e>=a){r=n;break}}else r=0;return r},getColorFromIndexValue:function(e){var t=this.getStepFromIndexValue(e);return this.lis.eq(t).data("color")},slideUp:function(e){var t=this;t.element.css("top","-="+e)},updateZoomLevel:function(e){this.clearValues()},clearValues:function(){this.val.text(0)},clearSelection:function(){this.lis&&this.lis.removeClass("selected")}},DateModel={timeFrom:null,timeTo:null,init:function(){var e=this;e.timeFrom=Application.timeFrom;e.timeTo=Application.timeTo;Timeline.setDates(e.timeFrom,e.timeTo);DateRange.update(e.timeFrom,e.timeTo)},setDate:function(e,t){var n=this;e!=null?n.timeFrom=parseInt(e):n.timeFrom=Application.timeFrom;t!=null?n.timeTo=parseInt(t):n.timeTo=Application.timeTo;n.timeFrom>n.timeTo&&(t?n.timeFrom=n.timeTo:e&&(n.timeTo=n.timeFrom));Application.updatePeriod(n.timeFrom,n.timeTo);MapDetailOverlay.close();Timeline.setDates(n.timeFrom,n.timeTo);DateRange.update(n.timeFrom,n.timeTo);Preloader.show()},getDates:function(){var e=this;return{first:e.firstDate,second:e.secondDate}}},DateRange={HIDE_BOTTOM_VALUE:"-296px",firstDate:null,secondDate:null,element:null,list:null,firstDateItems:null,firstDateMonthItems:null,secondDateItems:null,secondDateMonthItems:null,spans:null,appeared:null,currentFirstDate:null,currentSecondDate:null,cachedTimeFrom:null,cachedTimeTo:null,init:function(){var e=this;e.element=$(".dateRange");e.firstDate=new SingleDate(e.element.find(".firstDate"),e.onFirstDateChange);e.secondDate=new SingleDate(e.element.find(".secondDate"),e.onSecondDateChange);e.spans=e.element.find("span");e.element.find("header").click("on",function(){e.appeared?e.hide():e.appear()});e.element.find(".ok").click("on",function(){e.saveNewDate(!0)});e.element.find(".cancel").click("on",function(){e.cancelNewDate()});e.element.show()},onLiOver:function(){$(this).addClass("active")},onLiOut:function(){$(this).removeClass("active")},onLiClick:function(){},updateMonths:function(){console.log("updateMonths")},update:function(e,t){var n=this;n.firstDate.setDate(e);n.secondDate.setDate(t);var r=n.getDateForId(e),i=n.getDateForId(t);n.spans.eq(0).text(r.month);n.spans.eq(1).text(r.year);n.spans.eq(3).text(i.month);n.spans.eq(4).text(i.year)},onFirstDateChange:function(e){DateModel.setDate(e,null)},onSecondDateChange:function(e){DateModel.setDate(null,e)},displayErrorSequence:function(){alert(texts["Datum od musí být dřivější než datum do."])},saveNewDate:function(e){var t=this;e&&t.hide()},cancelNewDate:function(){var e=this;(Application.timeFrom!=e.cachedTimeFrom||Application.timeTo!=e.cachedTimeTo)&&DateModel.setDate(e.cachedTimeFrom,e.cachedTimeTo);e.hide()},appear:function(){var e=this;if(!e.appeared){e.appeared=!0;e.element.animate({bottom:0});e.cachedTimeFrom=Application.timeFrom;e.cachedTimeTo=Application.timeTo}},hide:function(){var e=this;if(e.appeared){e.appeared=!1;e.element.animate({bottom:e.HIDE_BOTTOM_VALUE})}},updateToModel:function(){var e=this,t=DateModel.getDates()},getDateForId:function(e){var t=[texts.Leden,texts["Únor"],texts["Březen"],texts.Duben,texts["Květen"],texts["Červen"],texts["Červenec"],texts.Srpen,texts["Září"],texts["Říjen"],texts.Listopad,texts.Prosinec],n=2003,r=Math.floor(e/12),i=e%12,s=n+r,o=t[i];return{month:o,year:s}}},ZoomControl={SLIDER_POSITION_HEIGHT:5,SLIDER_MIN_OFFSET:-95,SLIDER_MAX_OFFSET:-5,wrapper:null,element:null,slider:null,layerBtns:null,step:null,activeLayerBtn:null,slider:null,init:function(){var e=this;e.element=$(".zoomControl");switch(Application.zoomLevel){case 0:e.element.find("li.country div").addClass("selected");break;case 1:e.element.find("li.county div").addClass("selected");break;case 2:e.element.find("li.district div").addClass("selected");break;case 3:e.element.find("li.department div").addClass("selected")}e.layerBtns=e.element.find("li");e.layerBtns.on("mouseover",function(){$(this).find("div").addClass("active")}).on("mouseout",function(){$(this).find("div").removeClass("active")});e.slider=e.element.find(".btn")},updateToMap:function(e){var t=this.getSliderPositionForZoomLevel(e);this.slider.css("top",t)},getSliderPositionForZoomLevel:function(e){var t=0;switch(e){case 8:t="-15px";break;case 9:t="-26px";break;case 10:t="-37px";break;case 11:t="-48px";break;case 12:t="-59px";break;case 13:t="-70px";break;case 14:t="-81px";break;case 15:t="-92px";break;case 16:t="-103px"}return t},switchToTabulky:function(){this.element.addClass("tabulky")},switchToNormal:function(){this.element.removeClass("tabulky")}},Homepage={autocomplete:null,infoBox:InfoBox,timeline:Timeline,filterBox:FilterBox,boxWrapper:null,boxWrapperScrollbar:null,scrollApi:null,scrollPane:null,init:function(){var e=this;this.autoComplete=new AutoComplete({autoCompleteId:"autoComplete"});this.autoComplete.init();this.autoComplete.callbacks.onGeocodeResult=$.proxy(this.onGeocodeResult,this);InfoBox.init();Timeline.init();DateRange.init();DateModel.init();FilterBox.init();CrimeTypesBox.init();ContactForm.init();Legend.init();this.boxWrapper=$(".box-wrapper");this.boxWrapper.show();this.boxWrapper.jScrollPane();this.scrollApi=this.boxWrapper.data("jsp");this.boxWrapperScrollbar=this.boxWrapper.find(".jspVerticalBar")},update:function(e){InfoBox.update(e);FilterBox.update(e);Legend.update(e);ContactForm.update(e)},updateLayout:function(e,t){if(t==InfoBox){FilterBox.slideUp(e);Legend.slideUp(e)}else t==FilterBox&&Legend.slideUp(e);FilterBox.collapsed||InfoBox.collapsed?this.hideScrollbar():this.showScrollbar()},updateZoomLevel:function(e){InfoBox.updateZoomLevel(e);FilterBox.updateZoomLevel(e);Legend.updateZoomLevel(e);ContactForm.updateZoomLevel(e);Legend.clearSelection()},onGeocodeResult:function(e,t){var n=t;typeof t=="undefined"&&(n=13);Map.setViewPort(e,n)},isDisplayed:function(){return InfoBox.element.is(":visible")},resizeScrollbar:function(){this.scrollApi.reinitialise()},hideScrollbar:function(){this.boxWrapperScrollbar.hide()},showScrollbar:function(){this.boxWrapperScrollbar.show()}},Arc={draw:function(e,t,n,r,i,s){s===undefined&&(s=0);r==360&&(r=359.99999);var o=this,u=r-n,a=o.deg2rad(n+s),f=o.deg2rad(r+s),l=e+i*Math.cos(a),c=t+i*Math.sin(a),h=e+i*Math.cos(f),p=t+i*Math.sin(f),d="hsb(200,40,30)",v,m=u>180?1:0,g=u>0?1:0;v=[["M",l,c],["A",i,i,0,m,g,h,p]];return v},deg2rad:function(e){return e*Math.PI/180}};PorovnaniSelectBox.prototype.setValue=function(e){var t=this.options.filter("[data-area='"+e+"']");t.attr("selected","selected");t.trigger("chosen:updated");this.rankStepper.setValue(t.data("rank"));this.selectedId=t.data("area")};PorovnaniSelectBox.prototype.setValueByRank=function(e){var t=this.options.filter("[data-rank='"+e+"']");t.attr("selected","selected");t.trigger("chosen:updated");this.selectedId=t.data("area")};PorovnaniSelectBox.prototype.updateValues=function(e,t){var n=this,r=this.options.filter(":selected");n.element.empty();n.element.append("<option data-rank='0' data-area='-1'></option>");$.each(e,function(e,t){n.element.append("<option data-rank='"+t.Rank+"' data-area='"+t.Code+"'>"+$.trim(t.Name)+"</option>")});n.element.trigger("chosen:updated");n.options=this.element.find("option");if(t){if(r){n.selectedId=r.data("area");r=n.options.filter("[data-area='"+n.selectedId+"']");r.attr("selected","selected");r.trigger("chosen:updated")}}else{n.selectedId=-1;var i=texts["Vyber kraj"];Application.zoomLevel==2?i=texts["Vyber územní odbor"]:Application.zoomLevel==3&&(i=texts["Vyber obvodní oddělení"]);n.element.next().find("span").text(i)}};PorovnaniSelectBox.prototype.getSelectedRank=function(){var e=this.options.filter("[data-area='"+this.selectedId+"']");return e?e.data("rank"):0};PorovnaniTable.prototype.update=function(e){if(!e)return;var t=this;this.index=e.index;this.data=e;var n=e.graphCrimes,r=t.maxBarWidth(),i=.1;if(!n)return;$.each(this.rows,function(e,s){var o=$(s),u=o.data("crime-type"),a=n[u];if(a){comValue=parseInt(a.FoundSum),solvValue=parseInt(a.SolvedSum),percent=Math.round(solvValue/comValue*100);isNaN(percent)&&(percent="-");percent>1e4&&(percent="-");var f=DataUtil.checkDataSanity(a);o.find("td.title").text(a.name);o.find("td.first").text(DataUtil.addSpaces(comValue));o.find("td.second").text(DataUtil.addSpaces(solvValue));o.find("td.third").text(percent);o.find("td.bar .value").text(DataUtil.addSpaces(Math.round(a.index*10)/10));var l=0;a.index>0&&(l=Math.sqrt(a.index,i)/Math.sqrt(t.maxIndexValue,i)*r);o.find("td.bar div.graph").width(l)}else{var c=u==-1?"-":"0";o.find("td.first").text(c);o.find("td.second").text(c);o.find("td.third").text(c);o.find("td.bar .value").text(c)}});t.element.find("h2").html(Math.round(t.index*10)/10);var s=Math.sqrt(t.index,i)/Math.sqrt(t.maxIndexValue,i)*r;t.element.find(".index div.graph").width(s);t.computeVisibleValues()};PorovnaniTable.prototype.updateTotalValues=function(e,t){var n=this.element.find(".total").find(".values");n.find(".first").html(DataUtil.addSpaces(e));n.find(".second").html(DataUtil.addSpaces(t));var r=Math.round(t/e*100);isNaN(r)&&(r="-");n.find(".third").html(r)};PorovnaniTable.prototype.updateCustomCrime=function(e,t){console.log("porovnani table update cusotm crime");console.log(e,t);console.log(this.customRow);this.customRow.attr("data-crime-type",e);var n=this.customRow.find(".title");n.html(t);this.customRow.show()};PorovnaniTable.prototype.updateStaticValues=function(e,t){var n=this.element.find(".staticData").find(".total"),r=n.find("td");if(e&&e!="NaN"){r.eq(0).html(DataUtil.addSpaces(e)+" Kč");r.eq(0).removeClass("noData")}else{r.eq(0).html(texts["Data nejsou k dispozici"]);r.eq(0).addClass("noData")}r.eq(1).html(t)};PorovnaniTable.prototype.computeVisibleValues=function(){var e=this,t=this.rows.filter(":visible"),n=0,r=0;if(!e.data)return;$.each(t,function(t,i){var s=$(i),o=s.data("crime-type"),u=e.data.graphCrimes[o];if(u){comValue=u.FoundSum;solvValue=u.SolvedSum;n+=comValue;r+=solvValue}});this.updateTotalValues(n,r)};PorovnaniTable.prototype.maxBarWidth=function(){var e=Application.screenWidth>1200?440:360;return Application.screenWidth/2-e};PorovnaniTable.prototype.resize=function(){this.update(this.data)};PorovnaniTable.prototype.clearValues=function(){var e="-";this.element.find("td.first").text(e);this.element.find("td.second").text(e);this.element.find("td.third").text(e);var t=this.element.find(".staticData").find(".total"),n=t.find("td");n.text(e);this.element.find("h2").text(e);this.rows.find("td.bar div.graph").width(0);this.rows.find("td.bar div.value").text("");this.element.find(".index div.graph").width(0)};Math.logx=function(e,t){return Math.log(e)/Math.log(t|10)};RankStepper.prototype.updateRange=function(e,t){this.min=e;this.max=t;this.p.text(0)};RankStepper.prototype.update=function(e){var t=this,n=parseInt(this.p.text());if(e=="up"){if(!(n>t.min))return;n--}else if(e=="down"){if(!(n<t.max))return;n++}this.setValue(String(n));this.selectBox.setValueByRank(n);console.log("update rank sterper",n);this.opts.onChange&&this.opts.onChange.apply(this.selectBox,[this.selectBox.selectedId])};RankStepper.prototype.setValue=function(e){this.p.text(e);e>99?this.p.addClass("smallLetters"):this.p.removeClass("smallLetters")};var Porovnani={MIN_TOP:263,OFFSET:100,inited:!1,cachedFilters:"",element:null,inputs:null,tableRows:null,firstCol:null,secondCol:null,firstTable:null,firstSelectBox:null,firstRankStepper:null,secondTable:null,secondSelectBox:null,secondRankStepper:null,compareNotice:null,init:function(){var e=this;if(!e.inited){e.inited=!0;e.element=$("#porovnaniPage");e.firstCol=e.element.find(".firstCol");e.secondCol=e.element.find(".secondCol");e.element.find(".chosen-select").chosen({no_results_text:texts["Nic nenalezeno pro: "]});var t=$("#porovnaniPage .firstCol .rank"),n=$("#porovnaniPage .secondCol .rank");e.firstSelectBox=new PorovnaniSelectBox(e.firstCol.find(".firstSelect"),{onChange:e.handleSelectChange});e.secondSelectBox=new PorovnaniSelectBox(e.secondCol.find(".secondSelect"),{onChange:e.handleSelectChange});e.firstRankStepper=new RankStepper(t,e.firstSelectBox,{onChange:e.handleRankChange});e.secondRankStepper=new RankStepper(n,e.secondSelectBox,{onChange:e.handleRankChange});e.closeBtn=e.element.find(".closeBtn");e.closeBtn.on("click",function(){Navigator.switchToMapa()});e.firstSelectBox.rankStepper=e.firstRankStepper;e.secondSelectBox.rankStepper=e.secondRankStepper;e.firstTable=new PorovnaniTable(e.firstCol);e.secondTable=new PorovnaniTable(e.secondCol);e.tableRows=e.element.find("section.table table tr");e.tableRows.on("mouseover",function(){var t=$(this),n=t.attr("class").split(" "),r=e.tableRows.filter("."+n[0]);r.addClass("hover")}).on("mouseout",function(){var t=$(this),n=t.attr("class").split(" "),r=e.tableRows.filter("."+n[0]);r.removeClass("hover")});e.compareNotice=e.element.find(".compareNotice");e.compareNotice.find(".county").on("click",function(){showCounty()});e.compareNotice.find(".district").on("click",function(){showDistrict()})}e.updateZoomLevel(Application.zoomLevel);if(Application.selectedUnit>-1){function r(e){Porovnani.updateArea(Application.selectedUnit,e)}var i=DataProxy.getDataForArea(Application.selectedUnit,r,Application.filtersString)}if(Application.secondSelectedUnit>0){function s(e){Porovnani.updateSecondArea(Application.secondSelectedUnit,e)}var o=DataProxy.getDataForArea(Application.secondSelectedUnit,s,Application.filtersString)}var u=FilterBox.getUncheckedFilters();$.each(u,function(t,n){var r=n,i=e.tableRows.filter("."+r);i.hide()});if(Application.filters!=this.cachedFilters){this.cachedFilters=Application.filters;this.toggleTableRowVisibility(this.cachedFilters)}e.firstTable.computeVisibleValues();e.secondTable.computeVisibleValues();Application.customCrime&&this.updateCustomCrime(Application.customCrime.type,Application.customCrime.name);e.updateLayout(!0)},updateZoomLevel:function(e){var t=this;if(!t.secondCol)return;var n=DataProxy.getNamesAndIndexes(Application.zoomLevel);if(e==0){t.secondCol.hide();t.compareNotice.show()}else{t.secondCol.show();t.compareNotice.hide()}t.firstSelectBox.updateValues(n);t.secondSelectBox.updateValues(n);t.firstRankStepper.updateRange(1,t.firstSelectBox.element.find("option").length-1);t.secondRankStepper.updateRange(1,t.secondSelectBox.element.find("option").length-1);t.firstTable.maxIndexValue=n.maxValue;t.secondTable.maxIndexValue=n.maxValue;t.firstTable.clearValues();t.secondTable.clearValues()},toggleTableRowVisibility:function(e){if(!this.tableRows)return;this.tableRows.hide();var t=e.length;for(var n=0;n<t;n++){var r=e[n],i=this.tableRows.filter("[data-crime-type='"+r+"']");i.show()}this.updateLayout();this.firstTable.computeVisibleValues();this.secondTable.computeVisibleValues()},updateLayout:function(e){var t=this,n=Application.screenHeight-t.firstCol.height()-t.OFFSET;n=Math.max(t.MIN_TOP,n);t.element.css("top",n);!e&&!t.element.hasClass("anim")&&t.element.addClass("anim")},resize:function(){if(this.firstCol){this.updateLayout();this.firstTable.resize();this.secondTable.resize()}},handleSelectChange:function(e){if(this==Porovnani.firstSelectBox){Application.updateSelectedUnit(e);_gaq.push(["_trackEvent","porovnaniFirstSelect",Application.currentKey()])}else{Application.updateSecondSelectedUnit(e);_gaq.push(["_trackEvent","porovnaniSecondSelect",Application.currentKey()])}},handleRankChange:function(e){if(this==Porovnani.firstSelectBox){Application.updateSelectedUnit(e);_gaq.push(["_trackEvent","porovnaniFirstRankStepper",Application.currentKey()])}else{Application.updateSecondSelectedUnit(e);console.log("selectedId");_gaq.push(["_trackEvent","porovnaniSecondRankStepper",Application.currentKey()])}},updateArea:function(e,t){if(!this.inited)return;this.firstTable.update(t);this.firstSelectBox.setValue(e)},updateSecondArea:function(e,t){if(!this.inited)return;this.secondTable.update(t);this.secondSelectBox.setValue(e)},updatePeriodAndFilters:function(e,t){console.log("Porovnani updatePeriodAndFilters");if(!this.inited)return;this.firstTable.maxIndexValue=t.maxValue;this.secondTable.maxIndexValue=t.maxValue;this.firstSelectBox.updateValues(t,!0);this.secondSelectBox.updateValues(t,!0);this.firstRankStepper.setValue(this.firstSelectBox.getSelectedRank());this.secondRankStepper.setValue(this.secondSelectBox.getSelectedRank());this.firstTable.update(e);this.toggleTableRowVisibility(Application.filters,!0);if(Application.secondSelectedUnit>0){function n(e){Porovnani.updateSecondArea(Application.secondSelectedUnit,e)}var r=DataProxy.getDataForArea(Application.secondSelectedUnit,n,Application.filtersString)}},updateCustomCrime:function(e,t){this.firstTable&&this.firstTable.updateCustomCrime(e,t);this.secondTable&&this.secondTable.updateCustomCrime(e,t);this.toggleTableRowVisibility(Application.filters,!0)},isDisplayed:function(){var e=this;displayed=!1;e.element&&e.element.css("display")!="none"&&(displayed=!0);return displayed}};RankingSelectBox.prototype.changeHandler=function(e){var t=$(e).val();this.opts.onChange&&this.opts.onChange.apply(this,[t])};RankingSelectBox.prototype.setValue=function(e){var t=this.element.val(e);t.attr("selected","selected");t.trigger("chosen:updated");this.selectedType=e};var RankingsTable={element:null,rows:null,note:null,ths:null,table:null,downloadBtn:null,buttons:null,graphButtons:null,selectBox:null,opts:null,hidden:!0,cachedCrimeType:"",inited:!1,init:function(e){if(this.inited)return;this.inited=!0;var t=this;t.opts=e;var n=$("#tabulkyPage");t.element=n.find(".rankings");t.table=t.element.find("table");t.rows=t.element.find("tr").not(".header");var r=n.find(".crimesSelect");this.selectBox=new RankingSelectBox(r.find("select.county"),{onChange:t.selectChangeHandler});fdTableSort.init();t.downloadBtn=t.element.find(".downloadBtn");t.downloadBtn.on("click",function(e){e.preventDefault();getTable("rank");_gaq.push(["_trackEvent","downloadDataRankingsTable",Application.currentKey()])});t.select=$("#tabulkyPage").find(".crimesSelect");t.note=$("#tabulkyPage").find(".crimesSelect").find(".note")},selectChangeHandler:function(e){RankingsTable.updateToCrimeType(e);Application.selectedCrimeType=e},updateToCrimeType:function(e){typeof e=="undefined"&&(this.cachedCrimeType!=""?e=this.cachedCrimeType:e="101-903");this.selectBox.setValue(e);var t=this;setTimeout(function(){var n=DataProxy.getRankingsForCrimeType(e);t.cachedCrimeType=e;RankingsTable.update(e,n);Preloader.hide()},50);Preloader.show();_gaq.push(["_trackEvent","updateToCrimeType",Application.currentKey(),e])},update:function(e,t){var n=this;n.selectBox.setValue(e);n.rows.remove();var r=t.length,i=n.rows.length,s=0,o="";for(s;s<r;s++)o+=this.addNewRow(s,t[s]);n.table.append($(o));s=0;n.rows=n.element.find("tr").not(".header");n.rows.on("mouseover",function(){$tr=$(this);$tr.addClass("active")}).on("mouseout",function(){$tr=$(this);$tr.removeClass("active")});i=n.rows.length,n.buttons=n.element.find(".displayTypesBtn");n.buttons.off("click",n.displayCrimes);n.buttons.on("click",n.displayCrimes);n.graphButtons=n.element.find(".displayGraphBtn");n.graphButtons.off("click",n.displayGraph);n.graphButtons.on("click",n.displayGraph);fdTableSort.init()},renumberRows:function(){var e=this.table.find("tr").not(".header");$.each(e,function(e,t){var n=$(t).find("td");n.eq(0).text(e+1)})},addNewRow:function(e,t){t.I=Math.max(0,t.I);t.SolvedSum=Math.max(0,t.SolvedSum);t.FoundSum=Math.max(0,t.FoundSum);var n=e+1,r=Math.round(t.I*10)/10,i=Math.round(t.SolvedSum/t.FoundSum*100);isNaN(i)&&(i="-");i>1e4&&(i="-");if(t.Name=="MOP Smíchovské nádraží"||t.Name=="MOP Wilsonovo Nádraží"||t.Name=="OŽP Masarykovo nádraží Praha I.")n="N/A";return'<tr data-area-id="'+t.Code+'"><td>'+n+'</td><td class="first">'+DataUtil.formatTitle(t.Name)+'</td><td class="left">'+t.FoundSum+'</td><td class="right">'+r+'</td><td class="left">'+t.SolvedSum+'</td><td class="right">'+i+'</td><td class="displayTypes"><a href="#" class="displayTypesBtn" title="'+texts["Zobrazit přehled"]+'"></a><a href="#" class="displayGraphBtn" title="'+texts["Zobrazit graf"]+'"></a></td></tr>'},displayCrimes:function(e){e.preventDefault();var t=$(this),n=t.parent().parent(),r=n.data("area-id");RankingsTable.opts.onDisplayCrimes&&RankingsTable.opts.onDisplayCrimes.apply(this,[r])},displayGraph:function(e){e.preventDefault();var t=$(this),n=t.parent().parent(),r=n.data("area-id");RankingsTable.opts.onDisplayGraph&&RankingsTable.opts.onDisplayGraph.apply(this,[{area:r}])},updateZoomLevel:function(){this.updateToCrimeType(Application.selectedCrimeType)},hide:function(){if(this.rows&&this.element&&this.select){this.rows.removeClass("active");this.element.hide();this.select.hide();this.hidden=!0}},show:function(){this.element.show();this.select.show();this.hidden=!1}},TypesTable={element:null,rows:null,downloadBtn:null,buttons:null,graphButtons:null,rankStepper:null,selectBox:null,totalTds:null,generalTds:null,opts:null,hidden:!1,cachedCustomCrimeType:"",cachedTimeFrom:-1,cachedTimeTo:-1,cachedSelectedUnit:-1,init:function(e){var t=this;t.opts=e;var n=$("#tabulkyPage");t.element=$("#tabulkyPage").find(".crimes");t.typesTable=t.element.find(".types");t.rows=t.typesTable.find("tr");t.customRow=t.rows.last();t.rows=t.typesTable.find("tr");t.rows.on("mouseover",function(){$tr=$(this);$tr.addClass("active")}).on("mouseout",function(){$tr=$(this);$tr.removeClass("active")});t.buttons=t.element.find(".displayRankBtn");t.buttons.on("click",function(e){e.preventDefault();t.displayRanking(this)});t.graphButtons=t.element.find(".displayGraphBtn");t.graphButtons.on("click",function(e){e.preventDefault();t.displayGraph(this)});var r=n.find(".unitsSelect"),i=r.find(".rank");t.selectBox=new PorovnaniSelectBox(r.find("select.county"),{onChange:t.handleSelectChange});t.rankStepper=new RankStepper(i,t.selectBox,{onChange:t.handleRankChange});t.selectBox.rankStepper=t.rankStepper;t.downloadBtn=t.element.find(".downloadBtn");t.downloadBtn.on("click",function(e){e.preventDefault();getTable("types");_gaq.push(["_trackEvent","downloadDataTypesTable",Application.currentKey()])});t.generalTds=t.element.find(".general").find("tr td.left");t.totalTds=t.element.find(".total").find("tr").eq(1).find("td");t.select=n.find(".unitsSelect")},handleSelectChange:function(e){if(TypesTable.opts.onAreaSelect){TypesTable.opts.onAreaSelect.apply(this,[e]);_gaq.push(["_trackEvent","handleSelectChangeTypesTable",Application.currentKey()])}},handleRankChange:function(e){Application.updateSelectedUnit(e);_gaq.push(["_trackEvent","handleRankChangeTypesTable",Application.currentKey()])},displayRanking:function(e){var t=$(e),n=t.parent().parent(),r=n.data("crime-type");this.opts.onDisplayRank&&this.opts.onDisplayRank.apply(this,[r])},displayGraph:function(e){var t=$(e),n=t.parent().parent(),r=n.data("crime-type");this.opts.onDisplayGraph&&this.opts.onDisplayGraph.apply(this,[{crimeType:r}])},updateToArea:function(e){function t(e){TypesTable.update(e)}this.cachedSelectedUnit=e;this.cachedTimeFrom=Application.timeFrom;this.cachedTimeTo=Application.timeTo;this.selectBox.setValue(e);var n=DataProxy.getAllCrimeTypesForArea(e,t)},setValue:function(e){this.selectBox.setValue(e);this.updateSelectedUnit(e)},updateZoomLevel:function(e){this.selectBox.updateValues(e);this.rankStepper.updateRange(1,this.selectBox.element.find("option").length-1);this.clearValues()},update:function(e){if(!e)return;var t=this;if(e.total){var n=e.total,r=n.FoundSum>0?Math.round(n.SolvedSum/n.FoundSum*100):"-",i=DataUtil.addSpaces(Math.round(n.Index*10)/10);i.length>6?t.totalTds.eq(2).addClass("smallLetters"):t.totalTds.eq(2).removeClass("smallLetters");t.totalTds.eq(1).text(DataUtil.addSpaces(n.FoundSum));t.totalTds.eq(2).text(i);t.totalTds.eq(3).text(DataUtil.addSpaces(n.SolvedSum));t.totalTds.eq(4).text(r)}t.rows.remove();var s="";$.each(e.crimeTypesData,function(e,n){var r=n;s+=t.addNewRow(r)});t.typesTable.append($(s));t.rows=t.typesTable.find("tr");t.rows.on("mouseover",function(){$tr=$(this);$tr.addClass("active")}).on("mouseout",function(){$tr=$(this);$tr.removeClass("active")});t.buttons=t.element.find(".displayRankBtn");t.buttons.on("click",function(e){e.preventDefault();t.displayRanking(this)});t.graphButtons=t.element.find(".displayGraphBtn");t.graphButtons.on("click",function(e){e.preventDefault();t.displayGraph(this)});e.Population&&t.generalTds.eq(0).text(DataUtil.addSpaces(e.Population));e.Officers&&t.generalTds.eq(1).text(DataUtil.addSpaces(e.Officers));e.Area&&t.generalTds.eq(2).html(DataUtil.addSpaces(Math.round(e.Area)+" km<sup>2</sup>"));e.total&&e.total.Index&&t.generalTds.eq(3).text(DataUtil.addSpaces(Math.round(e.total.Index*10)/10))},addNewRow:function(e){e.index=Math.max(0,e.Index);e.SolvedSum=Math.max(0,e.SolvedSum);e.FoundSum=Math.max(0,e.FoundSum);var t=Math.round(e.Index*10)/10,n=Math.round(e.SolvedSum/e.FoundSum*100),r=appLanguage=="en"?e.CrimeName_en:e.CrimeName,i=e.IsMainCategory?"mainCategory":"";isNaN(n)&&(n="-");n>1e4&&(n="-");return'<tr data-crime-type="'+e.FK_Crime_Lookup+'" class="'+i+'"><td class="first">'+r+'</td><td class="left">'+e.FoundSum+'</td><td class="right">'+t+'</td><td class="left">'+e.SolvedSum+'</td><td class="right">'+n+'</td><td class="displayRank"><a href="#" class="displayRankBtn" title="'+texts["Zobrazit žebříček"]+'"></a><a href="#" class="displayGraphBtn" title="'+texts["Zobrazit graf"]+'"></a></td></tr>'},updateCustomCrime:function(e,t){this.cachedCustomCrime=e;this.customRow.attr("data-crime-type",e);var n=this.customRow.find(".first");n.html(t)},clearValues:function(){var e="-";this.element.find("td.left").text(e);this.element.find("td.right").text(e)},hide:function(){if(this.rows&&this.element&&this.select){this.rows.removeClass("active");this.element.hide();this.select.hide();this.hidden=!0}},show:function(){this.element.show();this.select.show();this.hidden=!1;(Application.selectedUnit!=this.cachedSelectedUnit||Application.timeFrom!=this.cachedTimeFrom||Application.timeTo!=this.cachedTimeTo)&&Application.selectedUnit!=-1&&this.updateToArea(Application.selectedUnit)}},TrendGraphPopups={init:function(e){this.$valuePopup=e.find(".value");this.$valueSolvPopup=e.find(".value-solv");this.$datePopup=e.find(".date")},appear:function(e,t,n,r,i,s){var o=i[0]-r[0],u=40;this.$valuePopup.show();this.$valuePopup.find("p").text(e);this.$valuePopup.css({top:r[0]-this.$valuePopup.height(),left:r[1]-this.$valuePopup.width()/2});if(t!=e){this.$valueSolvPopup.show();this.$valueSolvPopup.find("p").text(t);if(o>=u){this.$valueSolvPopup.removeClass("down");this.$valueSolvPopup.css({top:i[0]-this.$valueSolvPopup.height(),left:i[1]-this.$valueSolvPopup.width()/2})}else{this.$valueSolvPopup.addClass("down");this.$valueSolvPopup.css({top:i[0]+this.$valueSolvPopup.height()/2,left:i[1]-this.$valueSolvPopup.width()/2})}}else this.$valueSolvPopup.hide();this.$datePopup.show();var a=this.parseDateText(n);this.$datePopup.find("p").text(a);this.$datePopup.css({top:s[0]+this.$valuePopup.height()-10,left:s[1]-this.$datePopup.width()/2})},parseDateText:function(e){var t="-",n=e.split(t),r=parseInt(n[0]),i=DataUtil.getMonthFromIndex(r),s=parseInt(n[1]),o=i+" "+s;return o},hide:function(){this.$datePopup.hide();this.$valuePopup.hide();this.$valueSolvPopup.hide()}},Trend={hidden:!0,inited:!1,selectBox:null,cachedFilterString:"",cachedTimeFrom:-1,cachedTimeTo:-1,cachedSelectedUnit:-1,init:function(){if(this.inited)return;this.inited=!0;if(!Modernizr.svg)return;this.updateSize();this.$element=$(".trend");this.$chooseAreaNotice=this.$element.find(".trend-notice");this.$legendY=this.$element.find(".legendY");this.$legendX=this.$element.find(".legendX");this.$graphPopup=this.$element.find(".graphPopup");this.paths=[];var e=50;this.vis=d3.select("#svgHolder").append("svg:svg").attr("width",this.canvasWidth+e).attr("height",this.canvasHeight+e);this.$svg=this.$element.find("svg");TrendGraphPopups.init(this.$element.find(".popups"));var t=$("#tabulkyPage");this.$select=t.find(".unitsSelect");this.constraint=!0},updateToArea:function(e){this.cachedSelectedUnit=e;this.cachedTimeFrom=timeFrom;this.cachedTimeTo=timeTo;this.cachedFilterString=Application.filtersString();this.selectBox&&this.selectBox.setValue(e);this.area=e;this.updateData()},updatePeriod:function(){this.dates=[];this.updateData()},updateFilters:function(){this.updateData()},updateZoomLevel:function(e){this.selectBox.updateValues(e);this.rankStepper.updateRange(1,this.selectBox.element.find("option").length-1);this.clearGraph();if(this.$chooseAreaNotice){this.$chooseAreaNotice.show();var t="";switch(Application.zoomLevel){case 1:t=texts["Pro zobrazení grafu vyber kraj."];break;case 2:t=texts["Pro zobrazení grafu vyber územní odbor."];break;case 3:t=texts["Pro zobrazení grafu vyber obvodní oddělení."]}this.$chooseAreaNotice.text(t)}Application.zoomLevel==0&&this.rankStepper.setValue("1")},updateData:function(){Application.selectedUnit>-1&&DataProxy.getGraphData(Application.selectedUnit,$.proxy(this.doUpdate,this))},doUpdate:function(e){if(!Modernizr.svg)return;var t=this,n=20,r=Application.selectedUnit>-1?!0:!1;if(r)this.$chooseAreaNotice.hide();else{var i=150,s=35,o=254;this.$chooseAreaNotice.css({top:t.canvasHeight/2+i,left:t.canvasWidth/2-o/2+s})}this.clearGraph();var u=e.length,a,f,l,c=0,h=0,p,d,v,m;this.totalCircles=[];this.solvCircles=[];this.crimes=[];this.dates;var g=e.length;this.crimes=e.crimes;this.periodLen=e.periodLen;h=e.minValue;c=e.maxValue;var y=d3.scale.linear().domain([0,c]).range([this.canvasHeight,0]),b=d3.scale.linear().domain([0,this.periodLen]).range([0,this.canvasWidth]),w=y.domain()[1]-y.domain()[0],E=3,S=w/E,x=0,T=[];for(var N=0;N<=E;N++){T.push(x);x+=S}var C=this.vis.append("g").attr("class","graphWrapper");C.attr("transform","translate( 0,"+n+")");var k=d3.svg.axis().scale(y).tickValues(T).orient("right"),L=C.append("g").attr("class","axis").call(k.tickSize(0)).attr("transform","translate("+this.canvasWidth+", 0)"),A=C.append("g").attr("class","axis").call(k.tickSize(0).tickFormat("")),O=d3.svg.axis().scale(b).tickFormat(""),M=C.append("g").attr("class","grid").call(O.tickSize(this.canvasHeight)),_=C.append("g").attr("class","graph"),D=d3.svg.line().x(function(e,t){return b(t)}).y(function(e){return y(e.Found)});for(var P in this.crimes){var H=this.crimes[P];if(Application.selectedUnit>-1){var B=_.append("svg:g"),j=500,F=d3.svg.area().x(function(e,t){return b(t)}).y0(t.canvasHeight).y1(function(e){return y(e.Found)}),I=d3.svg.area().x(function(e,t){return b(t)}).y0(t.canvasHeight).y1(function(e){return y(e.Solved)});B.selectAll("table").data(H).enter().append("svg:circle").attr("class","circle-total").attr("stroke","black").attr("fill",function(e,t){return"black"}).attr("cx",function(e,t){return b(t)}).attr("cy",function(e,t){return y(e.Found)}).attr("r",function(e,t){return 0});B.selectAll("table").data(H).enter().append("svg:circle").attr("class","circle-solv").attr("stroke","black").attr("fill",function(e,t){return"black"}).attr("cx",function(e,t){return b(t)}).attr("cy",function(e,t){return y(e.Solved)}).attr("r",function(e,t){return 0});var q=B.selectAll("circle.circle-total");this.totalCircles[P]=q;var R=B.selectAll("circle.circle-solv");this.solvCircles[P]=R;var U=DataUtil.getColorForCrimeType(P);B.append("path").datum(H).attr("class","area").attr("d",F).style({fill:U[0]});B.append("path").datum(H).attr("class","area-solv").attr("d",I).style({fill:U[1]});B.append("svg:path").attr("d",D(H)).attr("class","stroke");B.append("svg:path").attr("d",D(H)).attr("class","buffer").attr("circles",q).on("mousemove",t.mousemove).attr("crime-type",P).on("mouseover",t.mouseover).on("mouseout",t.mouseout);B.style({stroke:U[0]});this.paths[P]=B}if(!this.dates||this.dates.length==0){this.dates=[];for(var N=0;N<H.length;N++){var P=H[N].Month+"-"+H[N].Year;this.dates.push(P)}}}var z=d3.svg.axis().scale(b).tickValues(b.domain()).tickFormat(Trend.parseDateText),W=C.append("g").attr("class","axis x-axis").call(z).attr("transform","translate( 0,"+this.canvasHeight+")"),X=this.$element.find(".x-axis").find("text");X.eq(0).css("text-anchor","start");X.eq(1).css("text-anchor","end")},mousemove:function(e,t){var n=Trend,r=d3.select(this),i=d3.mouse(this),s=r.attr("crime-type"),o=n.crimes[s],u=i[0]/n.canvasWidth,a=Math.round(u*n.periodLen),f=o
[a],l=n.totalCircles[s][0],c=l[a],h=n.solvCircles[s][0],p=h[a],d=[c.getAttribute("cx"),c.getAttribute("cy")],v=n.canvasToGlobal(d);d=[p.getAttribute("cx"),p.getAttribute("cy")];var m=n.canvasToGlobal(d);d=[p.getAttribute("cx"),n.canvasHeight];var g=n.canvasToGlobal(d);TrendGraphPopups.appear(f.Found,f.Solved,n.dates[a],v,m,g)},mouseover:function(e){d3.select(this.parentNode).classed("hover",!0);var t=this.parentNode,n=t.parentNode;n.appendChild(t);FilterBox.highlightType(d3.select(this).attr("crime-type"))},mouseout:function(e,t){d3.select(this.parentNode).classed("hover",!1);FilterBox.dehighlightType(d3.select(this).attr("crime-type"));TrendGraphPopups.hide()},canvasToGlobal:function(e){var t=157,n=35;return[t+parseInt(e[1]),n+parseInt(e[0])]},selectChangeHandler:function(){console.log("selectChangeHandler")},handleRankChange:function(e){Application.updateSelectedUnit(e)},show:function(){this.inited||this.init();this.$element.show();this.$select.show();FilterBox.enableForTrend();CrimeTypesBox.element.addClass("trendCrimeType");this.hidden=!1;if(Application.selectedUnit!=this.cachedSelectedUnit||Application.timeFrom!=this.cachedTimeFrom||Application.timeTo!=this.cachedTimeTo||Application.filtersString()!=this.cachedFilterString)if(Application.selectedUnit!=-1)this.updateToArea(Application.selectedUnit);else{this.clearGraph();this.$chooseAreaNotice&&this.$chooseAreaNotice.show()}},hide:function(){if(this.$element&&this.$select){this.$element.hide();this.$select.hide();FilterBox.disableForTrend();CrimeTypesBox.element.removeClass("trendCrimeType");this.hidden=!0}},parseDateText:function(e){var t="-",n=Trend.dates[e],r=n.split(t),i=parseInt(r[0]),s=DataUtil.getMonthFromIndex(i),o=parseInt(r[1]),u=s+" "+o;return u},highlightType:function(e){if(this.paths&&this.paths[e]&&this.paths[e][0]&&this.paths[e][0][0]){var t=this.paths[e][0][0];if(t){var n=t.getElementsByTagName("path")[0].parentNode,r=n.getAttribute("class");n.setAttribute("class",r+" hover");var i=n.parentNode;i.appendChild(t)}}},dehighlightType:function(e){if(this.paths&&this.paths[e]&&this.paths[e][0]&&this.paths[e][0][0]){var t=this.paths[e][0][0];if(t){var n=t.getElementsByTagName("path")[0].parentNode,r=n.getAttribute("class");if(r){var i=r.split(" ");i&&n.setAttribute("class",i[0])}}}},updateSize:function(){this.canvasWidth=Application.screenWidth*.7;this.canvasHeight=Application.screenHeight*.5},clearGraph:function(){this.vis&&this.vis.selectAll("g").remove()},resize:function(){if(this.$element){this.updateSize();this.updateData()}}},Tabulky={element:null,inited:!1,unitsTab:null,crimesTab:null,activeTab:TypesTable,secondCol:null,init:function(){var e=this;if(!e.inited){e.inited=!0;e.element=$("#tabulkyPage");e.secondCol=e.element.find(".secondCol");e.documentsSections=e.secondCol.find("section");e.element.find(".chosen-select").chosen({no_results_text:texts["Nic nenalezeno pro: "]});TypesTable.init({onDisplayRank:e.handleDisplayRank,onAreaSelect:e.handleAreaSelect,onDisplayGraph:e.handleDisplayGraph});Trend.selectBox=TypesTable.selectBox;Trend.rankStepper=TypesTable.rankStepper;RankingsTable.init({onDisplayCrimes:e.handleDisplayCrimes,onDisplayGraph:e.handleDisplayGraph});$.each(e.documentsSections,function(e,t){var n=$(t),r=n.find(".headerWrapper"),i=n.find(".articleContent"),s=n.find(".hideBtn");i.hide();s.toggleClass("hideBtnDown");r.on("click",function(){var e=$(this);i.slideToggle();s.toggleClass("hideBtnDown")})});e.downloadSection=e.element.find();e.unitsTab=e.element.find(".unitsTab");e.crimesTab=e.element.find(".crimesTab");e.trendTab=e.element.find(".trendTab");e.unitsTab.on("click",function(t){t.preventDefault();Tabulky.displayCrimes();e.unitsTab.addClass("active");e.crimesTab.removeClass("active");e.trendTab.removeClass("active");FilterBox.switchToTabulky()});e.crimesTab.on("click",function(t){t.preventDefault();Tabulky.displayRankings();e.crimesTab.addClass("active");e.unitsTab.removeClass("active");e.trendTab.removeClass("active");FilterBox.switchToTabulky()});e.trendTab.on("click",function(t){t.preventDefault();Tabulky.displayTrend();e.crimesTab.removeClass("active");e.unitsTab.removeClass("active");e.trendTab.addClass("active");FilterBox.switchToTrend()});e.unitsTab.addClass("active")}e.updateZoomLevel();var t;if(Application.selectedUnit>0){function n(e){Tabulky.updateArea(Application.selectedUnit,e)}t=DataProxy.getDataForArea(Application.selectedUnit,n,Application.filtersString)}},updateZoomLevel:function(){if(!this.inited)return;var e=DataProxy.getNamesAndIndexes(Application.zoomLevel);TypesTable.updateZoomLevel(e);Trend.updateZoomLevel(e)},updatePeriod:function(e){if(!this.inited)return;TypesTable.hidden||TypesTable.updateToArea(Application.selectedUnit);RankingsTable.hidden||RankingsTable.updateToCrimeType(Application.selectedCrimeType);Trend.hidden||Trend.updatePeriod()},updateArea:function(e,t){if(!this.inited)return;TypesTable.hidden||TypesTable.updateToArea(e);Trend.hidden||Trend.updateToArea(e)},updateFilters:function(e){if(!this.inited)return;TypesTable.selectBox.updateValues(e,!0);TypesTable.rankStepper.setValue(TypesTable.selectBox.getSelectedRank());Trend.hidden||Trend.updateFilters()},handleDisplayRank:function(e){Tabulky.displayRankings(e)},handleDisplayCrimes:function(e){Tabulky.displayCrimes(e)},handleDisplayGraph:function(e){e.hasOwnProperty("area")&&(isNaN(area)||Application.updateSelectedUnit(e.area));Tabulky.displayTrend(Application.selectedUnit)},handleAreaSelect:function(e){Application.updateSelectedUnit(e)},displayRankings:function(e){this.activeTab=RankingsTable;RankingsTable.inited||RankingsTable.init({onDisplayCrimes:self.handleDisplayCrimes,onDisplayGraph:self.handleDisplayGraph});RankingsTable.updateToCrimeType(e);TypesTable.hide();Trend.hide();RankingsTable.show();this.secondCol.show();Tabulky.crimesTab.addClass("active");Tabulky.unitsTab.removeClass("active");Tabulky.trendTab.removeClass("active");FilterBox.switchToTabulky();_gaq.push(["_trackEvent","displayRank",Application.currentKey()]);e&&(Application.selectedCrimeType=e)},displayCrimes:function(e){this.activeTab=TypesTable;RankingsTable.hide();Trend.hide();TypesTable.show();this.secondCol.show();Tabulky.crimesTab.removeClass("active");Tabulky.unitsTab.addClass("active");Tabulky.trendTab.removeClass("active");FilterBox.switchToTabulky();isNaN(e)||Application.updateSelectedUnit(e);_gaq.push(["_trackEvent","displayCrimes",Application.currentKey()])},displayTrend:function(e){this.activeTab=Trend;RankingsTable.hide();TypesTable.hide();Trend.show();Tabulky.unitsTab.removeClass("active");Tabulky.crimesTab.removeClass("active");Tabulky.trendTab.addClass("active");FilterBox.switchToTrend();_gaq.push(["_trackEvent","displayGraph",Application.currentKey()]);this.secondCol.hide()},updateCustomCrime:function(e,t){TypesTable.hidden||TypesTable.updateCustomCrime(e,t)},resize:function(){Trend.resize()},hide:function(){if(this.element){this.element.hide();TypesTable.hide();RankingsTable.hide();Trend.hide()}},show:function(){if(this.element){this.element.show();if(this.activeTab)switch(this.activeTab){case TypesTable:this.displayCrimes();break;case RankingsTable:this.displayRankings();break;case Trend:this.displayTrend()}else displayCrimes()}}},ContactForm={element:null,container:null,init:function(){var e=this;this.element=$(".contact");this.container=this.element.find(".contactInfo");this.nameInput=this.element.find("input[type=text]");this.textInput=this.element.find("textarea");this.container.append(this.getErrorMsg());this.emailToField=$("#frmcontactForm-emailTo");this.emailNotice=this.element.find(".email-notice");this.submitBtn=this.element.find("input[type=submit]");this.submitBtn.on("click",function(t){t.preventDefault();var n=e.validateForm(e.nameInput,e.textInput);n&&e.emailToField.val()&&e.submitForm(e.nameInput.val(),e.emailToField.val(),e.textInput.val())});this.switchToLanguage()},switchToLanguage:function(){this.element.find("input:text").attr("placeholder",texts["Jméno"]);this.element.find("textarea").attr("placeholder",texts["Zpráva"]);this.element.find("input:submit").attr("value",texts.ODESLAT)},update:function(e){this.container.empty();if(Application.zoomLevel>0){var t="";if(appLanguage=="cz"){t="Pokud chcete žádat o informace na základě zák. 106/1999 Sb. o svobodném přístupu k informacím, návod naleznete na stránkách ";t+="<a href='http://www.otevrete.cz/zadosti-o-informace/' target='_blank'><b style='color:#ffde00'>Otevřete.cz</b></a> při Otevřené společnosti, o.p.s.<p>"}else{t="If you wish to request information under the Freedom of Information Act. (No. 106/1999) from the police, instructions can be found ";t+="<a href='http://www.otevrete.cz/en/' target='_blank'><b style='color:#ffde00'>HERE</b></a><p>"}var n=$("<div><b>"+e.name+"</b><br /><br />"+e.contact_address+"<br /><br />tel: "+e.contact_phone+"<br />fax: "+e.contact_fax+"<br /><br />email:<br /><span class='mail'>"+e.contact_mail+"</span><br /><br />"+t+"</div>");this.element.find("textarea").attr("rows",13);this.container.append(n);this.emailToField.val(e.contact_mail)}else{var n=$("<div>"+texts["czech-republic-level-contact-notice"]+"</div>");this.container.append(n);this.emailToField.val("")}},validateForm:function(e,t){var n=!0;if(t.val().length>0)t.removeClass("error");else{n=!1;t.addClass("error")}return n},submitForm:function(e,t,n){console.log("submitForm ");var r="?do=submitContact",i=this;$.ajax({url:r,type:"POST",data:{name:e,emailTo:t,message:n},success:function(e){console.log("success");i.emailNotice.show();i.emailNotice.text(texts["e-mail-success"])},error:function(e){console.log("xhr");console.log(e);i.emailNotice.show();i.emailNotice.text(texts["e-mail-error"])}})},show:function(){this.element&&this.element.show()},hide:function(){this.element&&this.element.hide()},updateZoomLevel:function(){this.container.empty();this.container.append(this.getErrorMsg());this.emailToField.val("")},getErrorMsg:function(){var e=texts["Pro kontaktní informace vyber kraj v mapě."];Application.zoomLevel==2?e=texts["Pro kontaktní informace vyber odbor v mapě."]:Application.zoomLevel==3&&(e=texts["Pro kontaktní informace vyber oddělení v mapě."]);return e}},LogIn={forgetPasContent:null,show:function(){var e=this;$.ajax({url:"autorizace.html",dataType:"html",success:function(t){e.displayPage(e,t)}})},hide:function(){$(".insertedLogInContent").remove()},displayPage:function(e,t){var e=this;$(".insertedLogInContent").remove();var n=$.trim(t),r=$(n);r.each(function(){$(this).addClass("insertedLogInContent")});$("#main").append(r);r.css({position:"absolute",top:"10px",right:"10px"});e.forgetPasContent=r.find(".forgetPasContent");r.find(".lostPass").on("click",function(){log("lost pass click");e.forgetPasContent.toggle()})}},Navigator={TIMEOUT_DELAY:50,countryZoomBtn:null,countryZoomBtnDiv:null,countyZoomBtn:null,countyZoomBtnDiv:null,districtZoomBtn:null,districtZoomBtnDiv:null,departmentZoomBtn:null,departmentZoomBtnDiv:null,init:function(){var e=this;this.mapaBtn=$("#map");this.mapaBtns=$("#map, .logo");this.logoBtn=$(".logo");this.compareBtn=$("#compare");this.tableBtn=$("#table");this.porovnaniPage=$("#porovnaniPage");this.tabulkyPage=$("#tabulkyPage");this.autocomplete=$(".autoCompleteBox");this.homepageTimeline=$(".homepageTimeline");this.homepageLegendMain=$(".homepageLegendMain");this.homepageInfoBox=$(".homepageInfoBox");this.boxWrapper=$(".box-wrapper");this.countryZoomBtn=$(".country");this.countryZoomBtnDiv=this.countryZoomBtn.find("div");this.countyZoomBtn=$(".county");this.countyZoomBtnDiv=this.countyZoomBtn.find("div");this.districtZoomBtn=$(".district");this.districtZoomBtnDiv=this.districtZoomBtn.find("div");this.departmentZoomBtn=$(".department");this.departmentZoomBtnDiv=this.departmentZoomBtn.find("div");this.countryZoomBtn.on("click",$.proxy(this.showCountry,this));this.countyZoomBtn.on("click",$.proxy(this.showCounty,this));this.districtZoomBtn.on("click",$.proxy(this.showDistrict,this));this.departmentZoomBtn.on("click",$.proxy(this.showDepartment,this));window.location.hash==texts["#porovnani"]?this.switchToPorovnani(this,Application.selectedUnit):window.location.hash==texts["#tabulky"]?this.switchToTabulky():window.location.hash==texts["#mapa"]&&this.switchToMapa();this.compareBtn.on("click",function(t){e.switchToPorovnani(this,Application.selectedUnit);_gaq.push(["_trackEvent","mainMenuCompareBtn","",Application.currentKey()])});this.mapaBtns.on("click",function(t){e.switchToMapa();_gaq.push(["_trackEvent","mainMenuMapBtn","",Application.currentKey()])});this.tableBtn.on("click",function(t){e.switchToTabulky();_gaq.push(["_trackEvent","mainMenuTableBtn","",Application.currentKey()])});this.logoBtn.on("click",function(e){Map.resetMap();_gaq.push(["_trackEvent","logoClick","",Application.currentKey()])});$(".contactBtn").click(function(){ContactForm.show()});$(".homepageInfoBox .compareBtn").on("click",function(){e.switchToPorovnani(e.compareBtn,Application.selectedUnit);_gaq.push(["_trackEvent","compareBtnHomepage",Application.currentKey()])});$(".zoomIn").on("click",function(e){e.preventDefault();var t=Map.zoomIn();t&&ZoomControl.updateToMap(Map.map.getZoom());_gaq.push(["_trackEvent","mapZoomIn",Application.currentKey()])});$(".zoomOut").on("click",function(e){e.preventDefault();var t=Map.zoomOut();t&&ZoomControl.updateToMap(Map.map.getZoom());_gaq.push(["_trackEvent","mapZoomOut",Application.currentKey()])})},showCountry:function(e){e.preventDefault();this.showUnit(0)},showCounty:function(e){e.preventDefault();this.showUnit(1)},showDistrict:function(e){e.preventDefault();this.showUnit(2)},showDepartment:function(e){e.preventDefault();this.showUnit(3)},showUnit:function(e){var t=this;Preloader.show();setTimeout(function(){Application.updateZoomLevel(e);e!=0?t.countryZoomBtnDiv.removeClass("selected"):t.countryZoomBtnDiv.addClass("selected");e!=1?t.countyZoomBtnDiv.removeClass("selected"):t.countyZoomBtnDiv.addClass("selected");e!=2?t.districtZoomBtnDiv.removeClass("selected"):t.districtZoomBtnDiv.addClass("selected");e!=3?t.departmentZoomBtnDiv.removeClass("selected"):t.departmentZoomBtnDiv.addClass("selected");Map.init(Config.map)},this.TIMEOUT_DELAY)},switchToPorovnani:function(e,t){MapDetailOverlay.close();this.autocomplete.hide();this.homepageLegendMain.hide();this.homepageInfoBox.hide();this.homepageTimeline.show();this.homepageTimeline.addClass("porovnaniTimeline");ContactForm.hide();FilterBox.switchToPorovnani();ZoomControl.switchToNormal();this.boxWrapper.show();this.porovnaniPage.show();Tabulky.hide();Porovnani.init(t);this.boxWrapper.addClass("porovnani");this.mapaBtn.hasClass("active")&&this.mapaBtn.toggleClass("active");this.compareBtn.hasClass("active")||this.compareBtn.toggleClass("active");this.tableBtn.hasClass("active")&&this.tableBtn.toggleClass("active")},switchToMapa:function(e,t){this.autocomplete.show();this.homepageLegendMain.show();this.homepageInfoBox.show();this.homepageTimeline.show();this.homepageTimeline.removeClass("porovnaniTimeline");ContactForm.hide();FilterBox.switchToMapa();ZoomControl.switchToNormal();this.boxWrapper.show();this.porovnaniPage.hide();this.boxWrapper.removeClass("porovnani");Tabulky.hide();this.compareBtn.hasClass("active")&&this.compareBtn.toggleClass("active");this.mapaBtn.hasClass("active")||this.mapaBtn.toggleClass("active");this.tableBtn.hasClass("active")&&this.tableBtn.toggleClass("active");if(Application.selectedUnit<1)return},switchToTabulky:function(){MapDetailOverlay.close();this.autocomplete.hide();this.homepageLegendMain.hide();this.homepageInfoBox.hide();this.homepageTimeline.addClass("porovnaniTimeline");ContactForm.hide();CrimeTypesBox.hide();FilterBox.switchToTabulky();ZoomControl.switchToTabulky();this.porovnaniPage.hide();this.boxWrapper.removeClass("porovnani");this.boxWrapper.hide();Tabulky.init();Tabulky.show();this.mapaBtn.hasClass("active")&&this.mapaBtn.toggleClass("active");this.compareBtn.hasClass("active")&&this.compareBtn.toggleClass("active");this.tableBtn.hasClass("active")||this.tableBtn.toggleClass("active")}},AboutApplication={results:null,title:"",clickedTabIndex:0,init:function(e){var t=this,n;switch(e){case"#oAplikaciMapa":n="oAplikaci-mapaKriminality.html";t.title=texts["Mapa kriminality"];t.clickedTabIndex=0;break;case"#oAplikaciData":n="oAplikaci-data.html";t.title=texts.Data;t.clickedTabIndex=1;break;case"#oAplikaciUzivatele":n="oAplikaci-uzivatele.html";t.title=texts["Uživatelé"];t.clickedTabIndex=2;break;case"#oAplikaciAutori":n="oAplikaci-autori.html";t.title=texts["Autoři"];t.clickedTabIndex=3}$.ajax({url:n,dataType:"html",success:function(e){t.loadPage(t,e)}})},loadPage:function(e,t){e.results=t;e.displayLoadedPage()},displayLoadedPage:function(){var e=this;$(".insertedSubpageContent").remove();var t=$.trim(e.results),n=$(t);n.each(function(){$(this).addClass("insertedSubpageContent")});$("#oAplikaciPage").find(".subpageHolder").append(n);var r=$("#oAplikaciPage").find(".header a");$.each(r,function(t,n){t!=e.clickedTabIndex?$(n).removeClass("active"):$(n).addClass("active")});$("#oAplikaciPage").find(".header h1").text(e.title)}},MapDetailOverlay={CIRCLE_RADIUS:113,CIRCLE_GAP:7,ARC_WIDTH:54,ARC_GAP:2,X_ORIENTATION:-90,MARGIN_LEFT:100,MARGIN_TOP:50,paper:null,$domWrapper:null,detailBox:null,graph:null,graphArc:null,$centerText:null,data:null,animated:null,$svg:null,darkOverlay:null,isDetailDisplayed:!1,crimeTypes:[],display:function(e,t){this.crimeTypes=[];var n=e.graphCrimes,r=Homepage.boxWrapper.hasClass("competition-notice"),i=r?-15:25;if(Application.screenWidth<600){this.CIRCLE_RADIUS=80;this.ARC_WIDTH=34;this.MARGIN_LEFT=0;i=70}$(".contact").hide();var s=this,o=$(window).width(),u=$(window).height(),a=o/2+s.MARGIN_LEFT,f=u/2-s.MARGIN_TOP,l=null,c=0,h=0,p=0;s.darkOverlay||(s.darkOverlay=$(".mapDetailOverlayBack"));s.darkOverlay.show();s.data=e;s.animated=t;if(!s.paper){s.paper=Raphael("mapDetailOverlayHolder",o,u);s.$domWrapper=$("#mapDetailOverlayHolder");$(window).resize(function(){s.resize()})}else{s.$centerText&&s.$centerText.remove();s.paper&&s.paper.clear()}s.$domWrapper.show();var d=function(e){s.close.apply(s)};s.$domWrapper.click(d);s.graph=s.paper.set();var v=t?0:s.CIRCLE_RADIUS,m=s.paper.set(),g=.3;e.solvedSum>e.foundSum&&(e.foundSum=e.solvedSum);var y=360,b=e.solvedSum,w=e.foundSum-e.solvedSum,E=b/e.foundSum*y,S=w/e.foundSum*y;if(w<0){alert(texts["Máme problém s načtením dat, zkuste prosím zvolit jiné období nebo územní jednotku."]);Preloader.hide();return}y==360?g=0:g=.3;E=Math.min(E,359.99);S=Math.min(S,359.99);var x="101-903",T={index:e.index,FK_Crime_Lookup:x,FoundSum:e.foundSum,SolvedSum:e.solvedSum,CrimeName:"TRESTNÉ ČINY CELKEM",CrimeName_en:"ALL CRIMES"};s.crimeTypes[x]=T;var N=s.drawPieChartArc(a,f,s.CIRCLE_RADIUS,0,E,{fill:"#333333","stroke-width":0}),C=s.drawPieChartArc(a,f,s.CIRCLE_RADIUS,E-g,E+S,{fill:"#555555","stroke-width":0});N.node.id=x;C.node.id=x;m.push(N);m.push(C);m.rotate(-90,a,f);m.scale(1,-1,a,f);m.click(d);s.graph.push(m);d=function(e){s.handleArc.apply(s,[e])};m.mouseover(d).mouseout(d).mousemove(d);$.each(n,function(e,t){var n=t.FoundSum>t.SolvedSum?t.FoundSum:t.SolvedSum;c+=n;h++});s.graphArcs=s.paper.set();var k=!1,L=!1,A=0,y=h>1?360-(s.ARC_GAP-g)*h:360;y==360?g=0:g=.3;var O=Application.filters.slice(0);$.each(n,function(e,t){var n=t.FK_Crime_Lookup;$.inArray(n,O)==-1&&O.push(n)});var M=O.length;for(var _=0;_<M;_++){k=!0;var D=n[O[_]];if(!D)continue;var P=D.FK_Crime_Lookup,b=D.SolvedSum,H=D.FoundSum,w=H-b;w<0&&(w=0);var E=b/c*y,S=w/c*y;A+=y;H!=0&&(L=!0);var B=.75;if(E<B&&S<360){E=B;p-=B}if(S<B&&E<360){S=B;I+=B}var j=s.paper.set(),F=DataUtil.getColorForCrimeType(P);E==360&&(E=359.99);var I=p+E,q=s.drawArc(a,f,p,I);q.attr({"stroke-width":s.ARC_WIDTH,stroke:F[0]});q.node.id=P;S==360&&(S=359.99);p=I-g;I=p+S;var R=s.drawArc(a,f,p,I);R.attr({"stroke-width":s.ARC_WIDTH,stroke:F[1]});R.node.id=P;s.crimeTypes[P]=D;d=function(e){s.handleArc.apply(s,[e])};j.push(R,q);j.mouseover(d).mouseout(d).mousemove(d);p=I+s.ARC_GAP;s.graphArcs.push(j)}s.graph.push(s._graphArcs);if(!k||!L){s.paper.clear();s.close();return}s.$centerText=$("<div class='graphText'><span class='indexName'>"+texts["index kriminality"]+"</span><span class='indexValue'> </span><span class='country'> </span></div>");s.$domWrapper.append(s.$centerText);s.$centerText.find("span").css({display:"block"});s.$centerText.find("span.country").text(DataUtil.formatTitle(e.name));s.$centerText.find("span.indexValue").text(DataUtil.addSpaces(DataUtil.formatIndex(e.index)));s.$centerText.css({position:"absolute"});var U=s.$centerText.width(),z=s.$centerText.height();s.$centerText.css({left:o/2+s.MARGIN_LEFT-U/2,top:u/2-z/2-i});if(!s.detailBox){s.detailBox=$("<div></div>");s.detailBox.load(templateDir+texts["/mapDetailOverlayBox.html"]);s.detailBox.css({position:"absolute",zIndex:10});s.detailBox.css("pointer-events","none");s.$centerText.after(s.detailBox);s.detailBox.hide()}s.$centerText.find("a").on("click",function(){s.close()});s.isDetailDisplayed=!0;if(t){m.animate({scale:5},1e3);s.$centerText.hide();s.graphArcs.hide();s.graph.attr({opacity:0});s.graph.animate({opacity:1},300);setTimeout(s.appear,300);MapLayerOverviewPopUp.hide()}else s.appear()},appear:function(){function r(){var s=e.graphArcs[n];s.show();s.attr({"stroke-opacity":0});s.animate({"stroke-opacity":1},25,"linear",function(){});n++;n<t&&setTimeout(r,50)}var e=MapDetailOverlay;e.$centerText.show();var t=e.graphArcs.length,n=0;r()},drawArc:function(e,t,n,r){var i=this;arcRadius=i.CIRCLE_RADIUS+i.CIRCLE_GAP+i.ARC_WIDTH/2;var s=function(e){i.handleArc.apply(i,[e])};return i.paper.path(Arc.draw(e,t,n,r,arcRadius,i.X_ORIENTATION))},handleArc:function(e){var t=this,n=0,r=-4,i=t.crimeTypes[e.target.id];switch(e.type){case"mouseover":t.displayDetailBox(i);t.moveBoxToPosition(e.clientX-r,e.clientY-n);break;case"mouseout":t.detailBox.hide();break;case"mousemove":t.moveBoxToPosition(e.clientX-r,e.clientY-n)}},drawPieChartArc:function(e,t,n,r,i,s){var o=this,u=Math.PI/180,a=e+n*Math.cos(-r*u),f=e+n*Math.cos(-i*u),l=t+n*Math.sin(-r*u),c=t+n*Math.sin(-i*u);return o.paper.path(["M",e,t,"L",a,l,"A",n,n,0,+(i-r>180),0,f,c,"z"]).attr(s)},displayDetailBox:function(e){var t=this;t.detailBox.show();appLanguage=="cz"?t.detailBox.find("h2").text(e.CrimeName):t.detailBox.find("h2").text(e.CrimeName_en);var n=e.FoundSum,r=e.SolvedSum,i=n-r;t.detailBox.find(".first td").eq(2).text(DataUtil.addSpaces(Math.max(0,r)));t.detailBox.find(".second td").eq(2).text(DataUtil.addSpaces(Math.max(0,i)));var s=DataUtil.getColorForCrimeType(e.FK_Crime_Lookup);if(s&&s.length==2){t.detailBox.find(".first .legend").css("backgroundColor",s[0]);t.detailBox.find(".second .legend").css("backgroundColor",s[1])}var o=Math.round(r/n*100);isNaN(o)&&(o="0");o>1e4&&(o="-");o!="-"?t.detailBox.find(".percentage .value").text(Math.min(100,o)+" %"):t.detailBox.find(".percentage .value").text(o+" %")},moveBoxToPosition:function(e,t){this.detailBox.css({left:e-this.detailBox.width()/2+10,top:t-this.detailBox.height()})},resize:function(e,t){var n=this;if(!n.$centerText)return;n.isDisplayed()&&n.display(n.data,!1)},close:function(){var e=this;e.isDetailDisplayed=!1;if(!e.graphArcs)return;e.graphArcs.hide();e.graph.attr({opacity:1});e.graph.animate({opacity:0},300);e.$centerText&&e.$centerText.remove();e.detailBox&&e.detailBox.hide();setTimeout(function(){e.doClose()},300)},doClose:function(){var e=this;e.$domWrapper.hide();e.darkOverlay.fadeOut()},isDisplayed:function(){return this.isDetailDisplayed}},MapLayerOverviewPopUp={element:null,init:null,title:null,valueWrapper:null,value:null,indexWrapper:null,index:null,legend:null,lis:null,selectedValue:0,ranges:null,preloader:null,currentId:null,init:function(){if(this.inited)return;var e=this;this.inited=!0;e.element=$(".mapOverviewPopup");e.element.hide();e.title=e.element.find("h1");e.valueWrapper=e.element.find(".value");e.value=e.element.find(".value dd");e.indexWrapper=e.element.find(".index");e.index=e.element.find(".index dd");e.legend=e.element.find(".homepageLegend");e.preloader=$("<p class='overviewPreloader'>"+texts["Nahrávání dat..."]+"</p>");e.legend.after(e.preloader);e.elWidth=e.element.width(),e.elHeight=e.element.height();e.lis=e.element.find("li");e.ranges=[];$.each(e.lis,function(t,n){e.ranges.push($(n).text())});e.clearContent()},show:function(){var e=this;e.element&&e.element.show()},hide:function(){var e=this;if(!e.element)return;e.element.hide();e.clearContent()},clearContent:function(){this.legend.hide();this.indexWrapper.hide();this.valueWrapper.hide();this.preloader.show()},update:function(e,t,n){var r=this;if(t=="Česká republika"&&appLanguage=="en")t="Czech republic";else if(this.title.text()!=DataUtil.formatTitle(t))return;isNaN(e.value)?r.element.addClass("noData"):r.element.removeClass("noData");r.value.text(DataUtil.addSpaces(e.value));r.index.text(DataUtil.addSpaces(DataUtil.formatIndex(e.index)));r.lis.removeClass("selected");var i=r.getStepFromFillColor(n);r.selectedValue=r.lis.eq(i).addClass("selected").text();this.legend.show();this.indexWrapper.show();this.valueWrapper.show();this.preloader.hide()},updateName:function(e){appLanguage=="en"&&Application.zoomLevel==0&&(e="Czech republic");this.title.text(DataUtil.formatTitle(e))},moveTo:function(e){e.top-=this.elHeight-55;e.left-=this.elWidth/2;this.element.css({top:e.top,left:e.left})},updateRanges:function(e){var t=this,n=0;t.ranges=e;if(!t.lis)return;$.each(e,function(e,n){t.lis.eq(e).text(n)})},getStepFromIndexValue:function(e){var t=this,n=0,r=-1,i=t.lis.length;for(n=0;n<i;n++){var s=t.ranges[n],o=s.split("-"),u=parseFloat(o[0]),a=parseFloat(o[1]);e=Math.floor(e);a=Math.floor(a);u=Math.floor(u);var f=a==u?!0:!1;if(!f){if(e>=u&&e<a){r=n;break}}else if(e>=a){r=n;break}}return r},getStepFromFillColor:function(e){var t=-1;switch(e){case"#fadbde":t=0;break;case"#f5a6ab":t=1;break;case"#ee7079":t=2;break;case"#e93a46":t=3;break;case"#e20613":t=4}return t}},MapLayer={DEFAULT_STYLE:{strokeColor:"#333333",strokeOpacity:.5,fillColor:"#fadbde",fillOpacity:.6},FTresponse:null,query:"",gpolygons:[],dummyOverlay:null,map:null,styles:null,geoXml:null,inited:!1,init:function(e){function n(e){var n=5,r=0,i=e.length;if(e){var i=e.length;for(var s=0;s<i;s++)t.parseKml(s,e[s])}Preloader.hide()}var t=this;t.map=e;this.dummyOverlay=new google.maps.OverlayView;this.dummyOverlay.draw=function(){};this.dummyOverlay.setMap(t.map);var t=this;this.geoXml=new geoXML3.parser({map:t.map,zoom:!1,suppressInfoWindows:!0});var r=this.inited?!1:!0;DataProxy.getAreaGeometry(n,r);this.inited=!0},normalizeCode:function(e,t){e==3?t<1e4?t="00"+parseInt(t):t<1e5?t="0"+parseInt(t):t=parseInt(t):e==2?t<100?t="00"+parseInt(t):t<1e3?t="0"+parseInt(t):t=parseInt(t):e==1?t<10?t="0"+parseInt(t)+"00":t<1e3?t="0"+parseInt(t):t=parseInt(t):e==0&&(t="0");return t},clear:function(){if(this.gpolygons&&this.gpolygons.length>0)for(var e in this.gpolygons);this.gpolygons=[]},parseKml:function(e,t){var n=this,r=this.gpolygons,i=null,s=t.Code,o=t.Name,u=t.Geometry;this.geoXml.parseKmlString("<Placemark><name>"+o+"</name><description><![CDATA[]]></description>"+u+"</Placemark>");var a={};if(this.geoXml.docs[e].placemarks[0].Polygon){this.geoXml.docs[e].gpolygons[0].setMap(n.map);a.id=s;a.polygon=this.geoXml.docs[e].gpolygons[0];a.position=this.geoXml.docs[e].gpolygons[0].bounds.getCenter();a.bounds=this.geoXml.docs[e].gpolygons[0].bounds;var f=a.polygon,l=this.styles[s];this.setPolygonStyle(s,f,l);google.maps.event.addListener(this.geoXml.docs[e].gpolygons[0],"mouseover",function(e){var t=n.gpolygons[s];if(t){var r=t.length;for(var i=0;i<r;i++)t[i].polygon.setOptions({strokeColor:"#000",strokeWeight:2,strokeOpacity:.6})}var u=n.dummyOverlay.getProjection().fromLatLngToContainerPixel(e.latLng);MapLayerOverviewPopUp.show();MapLayerOverviewPopUp.moveTo({top:u.y,left:u.x});n.updateOverviewPopup(s,o,this.fillColor)});google.maps.event.addListener(this.geoXml.docs[e].gpolygons[0],"mousemove",function(e){var t=n.dummyOverlay.getProjection().fromLatLngToContainerPixel(e.latLng);MapLayerOverviewPopUp.moveTo({top:t.y,left:t.x})});google.maps.event.addListener(this.geoXml.docs[e].gpolygons[0],"mouseout",function(){var e=n.gpolygons[s];if(e){var t=e.length;for(var r=0;r<t;r++)l&&e[r].polygon.setOptions({strokeColor:l.strokeColor,strokeWeight:1,strokeOpacity:l.strokeOpacity})}MapLayerOverviewPopUp.hide()});google.maps.event.addListener(this.geoXml.docs[e].gpolygons[0],"click",function(){Map.handleClick(s)})}a.name=o;r[s]||(r[s]=[]);r[s].push(a)},updateOverviewPopup:function(e,t,n){function r(e){MapLayerOverviewPopUp.update(e,t,n)}MapLayerOverviewPopUp.updateName(t);var i=DataProxy.getDataForAreaOverview(e,r,Application.filters)},updateLayerStyles:function(e){this.styles=e;for(var t in this.gpolygons){var n=this.styles[t],r=this.gpolygons[t];if(r){var i=r.length;for(var s=0;s<i;s++){var o=r[s];this.setPolygonStyle(t,o.polygon,n)}}}return this.gpolygons.length>0?!0:!1},setPolygonStyle:function(e,t,n){t.setVisible(!0);n?t.setOptions({strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,fillColor:n.fillColor,fillOpacity:n.fillOpacity}):t.setOptions(this.DEFAULT_STYLE)}},Map={CUSTOM_MAP_TYPE_NAME:"Mapa kriminality",MAX_ZOOM:16,MIN_ZOOM:6,INITIAL_ZOOM:7,INITIAL_LOCATION:new google.maps.LatLng(49.667718,13.8),map:null,infoWindow:null,fussionTablesLayer:null,isMapLayerActive:!0,init:function(e){var t=this,n=[{featureType:"all",elementType:null,stylers:[{lightness:30},{saturation:-100}]}],r={name:t.CUSTOM_MAP_TYPE_NAME,alt:t.CUSTOM_MAP_TYPE_NAME},i=new google.maps.StyledMapType(n,r),s={center:t.INITIAL_LOCATION,zoom:t.INITIAL_ZOOM,panControl:!1,zoomControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,minZoom:t.MIN_ZOOM,maxZoom:t.MAX_ZOOM,mapTypeControlOptions:{mapTypeIds:[]}};t.map=new google.maps.Map(document.getElementById(e.wrapperId),s);t.map.mapTypes.set(t.CUSTOM_MAP_TYPE_NAME,i);t.map.setMapTypeId(t.CUSTOM_MAP_TYPE_NAME);t.infoWindow=new google.maps.InfoWindow;google.maps.event.addListener(t.map,"mouseout",function(e){MapLayerOverviewPopUp.hide()});google.maps.event.addListener(t.map,"dragstart",function(e){MapLayerOverviewPopUp.hide()});google.maps.event.addListener(t.map,"zoom_changed",function(e){ZoomControl.updateToMap(t.map.getZoom())});google.maps.event.addListenerOnce(t.map,"tilesloaded",function(e){$("#mapWrapper").find(".gmnoprint").eq(0).css("bottom","35px")});MapLayerOverviewPopUp.init();t.updateMapLayer();MapLayer.init(t.map)},updateMapLayer:function(){var e=this,t=DataProxy.loadMapStyles(Application.zoomLevel),n=e.writeStyle(t),r=MapLayer.updateLayerStyles(n);r&&Preloader.hide()},handleClick:function(e){Application.updateSelectedUnit(e,null,!0);Map.infoWindow.close();_gaq.push(["_trackEvent","mapClick",Application.currentKey()])},writeStyle:function(e){var t=this,n=[];$.each(e,function(e,t){n.push(Math.round(t.I*10)/10)});var r=DynamicRange.classifyJenks(n,5,e.maxValue);Legend.updateRanges(r);MapLayerOverviewPopUp.updateRanges(r);var i=[];$.each(e,function(e,t){var n=Legend.getColorFromIndexValue(t.I);i[t.Code]={id:t.Code,fillColor:n,fillOpacity:.6,strokeColor:"#333333",strokeOpacity:.5}});return i},zoomIn:function(){var e=this,t=e.map.getZoom();if(t<e.MAX_ZOOM){t++;e.map.setZoom(t);return!0}return!1},zoomOut:function(){var e=this,t=e.map.getZoom();if(t>e.MIN_ZOOM){t--;e.map.setZoom(t);return!0}return!1},setViewPort:function(e,t){if(t instanceof google.maps.LatLngBounds)this.map.fitBounds(t);else{this.map.setZoom(t);this.map.setCenter(e)}},clearMapLayer:function(){MapLayer.clear()},resetMap:function(){if(this.map){this.map.setCenter(this.INITIAL_LOCATION);this.map.setZoom(this.INITIAL_ZOOM)}}},Tester={tests:[],init:function(){HomepageTester.init();$.ajax({url:"?do=getAreas",type:"POST",dataType:"json",data:{zoomLevel:3},success:function(e){var t=e.length;console.log("init homepagetest",t);for(var n=0;n<t;n++){var r=e[n];Tester.addTest({type:"getArea",id1:r.Code,id2:null,zoomLevel:3,timeFrom:120,timeTo:129,interval:2500})}Tester.runTests()},error:function(e){console.error("error");console.error(e)}})},setSelectedUnit:function(e){Application.updateSelectedUnit(e)},setZoomLevel:function(e){switch(e){case 0:showCountry();break;case 1:showCounty();break;case 2:showDistrict()}},setTimePeriod:function(e,t){DateRange.currentFirstDate=e;DateRange.currentSecondDate=t;DateRange.saveNewDate()},setFilters:function(e){Application.filters=e;Application.updateFilters()},switchToPorovnani:function(){switchToPorovnani(this,Application.selectedUnit)},switchToTabulky:function(){switchToTabulky()},addTest:function(e){this.tests.push(new Test(e))},runTests:function(){function r(t,r){Tester.log("running test: "+t+1+" from: "+n);t<n?e.tests[t].run(r):Tester.log("all tests complete")}var e=this,t=0,n=this.tests.length
;r(t,function(){console.log("run next test");t++;r(t)})},log:function(e){console.log("tester log: ",e)}};Test.prototype.run=function(e){function n(){log("setZoomLevel");var e=!1;log(t.zoomLevel);if(t.zoomLevel){zoomChange=!0;Tester.setZoomLevel(t.zoomLevel)}e?setTimeout(r,t.interval):r()}function r(){log("setTimePeriod");var e=!1;if(t.timePeriod){e=!0;Tester.setTimePeriod(t.timePeriod.firstDate,t.timePeriod.secondDate)}e?setTimeout(i,t.interval):i()}function i(){log("setFilters");var e=!1;if(t.filters){e=!0;Tester.setFilters(t.filters)}e?setTimeout(s,t.interval):s()}function s(){log("runTest",t.type,t.zoomLevel,t.timeFrom,t.timeTo,t.filters,t.id1,t.id2,t.crimeTypes);if(t.type=="getArea"){console.log("runTest2",e);HomepageTester.testSelectUnits(t.id1,t.id2,t.timeFrom,t.timeTo,e)}else if(t.type=="porovnaniGetArea"){Tester.switchToPorovnani();setTimeout(function(){t.zoomLevel!=2?PorovnaniTester.testSelectUnits(t.id1,t.id2,e):PorovnaniTester.testSelectUnits(t.id1,t.id2,e,Tester.BLACKLISTED_DISTRICT_IDS)},1e3)}else if(t.type=="porovnaniSecondGetArea"){Tester.switchToPorovnani();setTimeout(function(){t.zoomLevel!=2?PorovnaniTester.testSecondSelectUnits(t.id1,t.id2,e):PorovnaniTester.testSecondSelectUnits(t.id1,t.id2,e,Tester.BLACKLISTED_DISTRICT_IDS)},1e3)}else if(t.type=="porovnaniSwitchFromMapa"){Tester.setSelectedUnit(t.id1);setTimeout(function(){Tester.switchToPorovnani();setTimeout(function(){PorovnaniTester.takeSnapshotOfPorovnani()},t.interval)},t.interval)}else if(t.type=="tabulkyGetArea"){Tester.switchToTabulky();setTimeout(function(){t.zoomLevel!=2?TabulkyTester.testSelectUnits(t.id1,t.id2,e):TabulkyTester.testSelectUnits(t.id1,t.id2,e,Tester.BLACKLISTED_DISTRICT_IDS)},t.interval)}else if(t.type=="tabulkyGetArea"){Tester.switchToTabulky();setTimeout(function(){t.zoomLevel!=2?TabulkyTester.testSelectUnits(t.id1,t.id2,e):TabulkyTester.testSelectUnits(t.id1,t.id2,e,Tester.BLACKLISTED_DISTRICT_IDS)},t.interval)}else if(t.type=="tabulkyGetCrimeType"){Tester.switchToTabulky();setTimeout(function(){TabulkyTester.testSelectCrimeTypes(t.crimeTypes,e)},t.interval)}}var t=this;s()};var HomepageTester={init:function(){function e(){Tester.log("complete testing select unit")}},testSelectUnits:function(e,t,n,r,i,s){function a(e){Tester.log("testing select unit with id: "+e);Application.updateSelectedUnit(e);setTimeout(HomepageTester.takeSnapshotOfHomepage,u-100)}function f(){a(o);clearInterval(l);i&&setTimeout(i,2e3)}Tester.log("testing update selected unit");var o=e,u=1500,l=setInterval(f,u)},takeSnapshotOfHomepage:function(){Tester.log("infobox values: "+InfoBox.title.text()+", "+InfoBox.index.text()+", "+InfoBox.total.text()+", "+InfoBox.officers.text()+", "+InfoBox.damage.text()+", "+InfoBox.rank.text());var e=FilterBox.element.find("span.val"),t="";$.each(e,function(e,n){t+=$(n).text();t+=", "});Tester.log("filterbox values: "+t);Tester.log("infobox values: "+Legend.ranges)}},PorovnaniTester={testSelectUnits:function(e,t,n,r){function o(e){var t=$.inArray(e,r);if(t==-1){Tester.log("testing select unit with id: "+e);Application.updateSelectedUnit(e);setTimeout(PorovnaniTester.takeSnapshotOfPorovnani,s-100)}else Tester.log("skipping blacklisted id "+e)}function u(){o(i);i++;if(i==t){clearInterval(a);n&&setTimeout(n,2e3)}}Tester.log("porovnani testing update selected unit");var i=e,s=1500,a=setInterval(u,s)},testSecondSelectUnits:function(e,t,n,r){function o(e){var t=$.inArray(e,r);if(t==-1){Tester.log("testing select unit with id: "+e);Application.updateSecondSelectedUnit(e);setTimeout(PorovnaniTester.takeSnapshotOfPorovnani,s-100)}else Tester.log("skipping blacklisted id "+e)}function u(){o(i);i++;if(i==t){clearInterval(a);n&&setTimeout(n,2e3)}}Tester.log("porovnani testing second selected unit");log(n);var i=e,s=1500,a=setInterval(u,s)},takeSnapshotOfPorovnani:function(){log("takeSnapshotOfPorovnani");var e=Porovnani.firstTable,t="total values: "+e.element.find("td.first").text()+", "+e.element.find("td.second").text()+", "+e.element.find("td.third").text(),n=e.element.find(".staticData").find(".total").find("td"),r="static values:  ";r+=n.eq(0).text()+", ";r+=n.eq(1).text()+", ";var i="rowValues:";$.each(e.rows,function(e,t){var n=$(t);i+=n.find("td.first").text()+", ";i+=n.find("td.second").text()+", ";i+=n.find("td.third").text()+", ";i+=n.find("td.bar .value").text()+", "});Tester.log("porovnani left table - "+t+r+i+", maxIndexValue: "+e.maxIndexValue);var s=Porovnani.secondTable;t="total values: "+s.element.find("td.first").text()+", "+s.element.find("td.second").text()+", "+s.element.find("td.third").text();var n=s.element.find(".staticData").find(".total").find("td"),r="static values:  ";r+=n.eq(0).text()+", ";r+=n.eq(1).text()+", ";var i="rowValues:";$.each(s.rows,function(e,t){var n=$(t);i+=n.find("td.first").text()+", ";i+=n.find("td.second").text()+", ";i+=n.find("td.third").text()+", ";i+=n.find("td.bar .value").text()+", "});Tester.log("porovnani right table - "+t+r+i+", maxIndexValue: "+e.maxIndexValue)}},TabulkyTester={testSelectUnits:function(e,t,n,r){function o(e){var t=$.inArray(e,r);if(t==-1){Tester.log("testing select unit with id: "+e);Application.updateSelectedUnit(e);setTimeout(TabulkyTester.takeSnapshotOfTabulky,s-100)}else Tester.log("skipping blacklisted id "+e)}function u(){o(i);i++;if(i==t){clearInterval(a);n&&setTimeout(n,2e3)}}Tester.log("tabulky testing update selected unit");var i=e,s=1500,a=setInterval(u,s)},testSelectCrimeTypes:function(e,t){function s(e){Tester.log("testing crimetype: "+e);Tabulky.displayRankings(e);setTimeout(TabulkyTester.takeSnapshotOfRankingsTable,i-100)}function o(){s(n);n++;if(n==r){clearInterval(u);t&&setTimeout(t,2e3)}}Tester.log("tabulky testing select crime type: ");log(e);var n=0,r=e.length,i=1500,u=setInterval(o,i)},takeSnapshotOfTypesTable:function(){log("takeSnapshotOfTypesTable");var e="total values: ";e+=TypesTable.totalTds.eq(1).text()+", ";e+=TypesTable.totalTds.eq(2).text()+", ";e+=TypesTable.totalTds.eq(3).text()+", ";e+=TypesTable.totalTds.eq(4).text()+", ";var t="rowValues: ";$.each(TypesTable.rows,function(e,n){var r=$(n),i=r.find("td");t+=i.eq(1).text()+", ";t+=i.eq(2).text()+", ";t+=i.eq(3).text()+", ";t+=i.eq(4).text()+", "});var n="generalValue: ";n+=TypesTable.generalTds.eq(0).text()+", ";n+=TypesTable.generalTds.eq(1).text()+", ";n+=TypesTable.generalTds.eq(2).text()+", ";n+=TypesTable.generalTds.eq(3).text()+", ";Tester.log("tabulky types table - "+e+t+n)},takeSnapshotOfRankingsTable:function(){log("takeSnapshotOfRankingsTable");var e="rowValues: ";$.each(RankingsTable.rows,function(t,n){var r=$(n),i=r.find("td");e+=i.eq(0).text()+", ";e+=i.eq(1).text()+", ";e+=i.eq(2).text()+", ";e+=i.eq(3).text()+", ";e+=i.eq(4).text()+", "});Tester.log("tabulky rankings table - "+e)}},Application={screenWidth:0,screenHeight:0,zoomLevel:3,selectedUnit:-1,secondSelectedUnit:"",timeFrom:0,timeTo:0,filters:null,defaultFilters:null,selectedCrimeType:"101-903",customCrime:null,init:function(e){var t=$(window);this.screenWidth=t.width();this.screenHeight=t.height();this.timeFrom=timeFrom;this.timeTo=timeTo;var n=this;this.filters=[];var r=[],i=$(".homepageFilterBox").find("li"),s=i.length;this.defaultFilters="";$.each(i,function(e,t){var r=$(t),i=r.find("input"),o=i.is(":checked"),u=r.data("crime-type").toString();o&&n.filters.push(u);u==-1&&(n.defaultFilters+="'"+u+"'");e<s-1&&(n.defaultFilters+=",")});Preloader.init();Application.zoomLevel=3;Application.timeFrom=timeFrom;Application.timeTo=timeTo;Homepage.init();Map.init(Config.map);ZoomControl.init();Navigator.init();DataProxy.getNamesAndIndexes(Application.zoomLevel);var n=this;$(window).on("resize",function(){var e=$(this);n.screenWidth=e.width();n.screenHeight=e.height();Porovnani.resize();Tabulky.resize()});$(window).trigger("resize")},updateSelectedUnit:function(e,t,n){function i(e){var r=DataUtil.checkCorrectData(e);if(!r){Preloader.hide();return}Homepage.update(e);Homepage.isDisplayed()&&(t||n)&&MapDetailOverlay.display(e,!0);Porovnani.updateArea(Application.selectedUnit,e);Tabulky.updateArea(Application.selectedUnit,e);Preloader.hide()}var r=this;setTimeout(function(){var n=DataProxy.getDataForArea(e,i,Application.filtersString,t)},50);Application.selectedUnit=e;Preloader.show()},updateSecondSelectedUnit:function(e){function t(e){var t=DataUtil.checkCorrectData(e);if(!t){Preloader.hide();return}Porovnani.updateSecondArea(Application.secondSelectedUnit,e);Preloader.hide()}Preloader.show();Application.secondSelectedUnit=e;setTimeout(function(){var n=DataProxy.getDataForArea(e,t,Application.filtersString)},50)},updateZoomLevel:function(e,t){this.zoomLevel=e;Application.selectedUnit=this.zoomLevel!=0?-1:0;MapDetailOverlay.isDisplayed&&MapDetailOverlay.close();t||Map.clearMapLayer();var n=DataProxy.getNamesAndIndexes(Application.zoomLevel);Homepage.updateZoomLevel(e);Porovnani.updateZoomLevel(e);Tabulky.updateZoomLevel(e);if(this.zoomLevel==0){function r(e){Homepage.update(e);Porovnani.isDisplayed()&&Porovnani.updateArea(0,e);Tabulky.updateArea(0,e)}DataProxy.getDataForArea(Application.selectedUnit,r,Application.filtersString)}},updatePeriod:function(e,t){var n=this;Preloader.show();this.timeFrom=e;this.timeTo=t;Application.selectedPeriod=e+"-"+t;setTimeout(function(){function t(t){t.rankValue=InfoBox.findRankById(t.id);if(t.rankValue==0){Application.updateZoomLevel(Application.zoomLevel,!0);return}Map.updateMapLayer();Homepage.update(t);Porovnani.isDisplayed()&&Porovnani.updatePeriodAndFilters(t,e);Tabulky.updatePeriod(t);Preloader.hide()}var e=DataProxy.getNamesAndIndexes(Application.zoomLevel);if(Application.selectedUnit>-1)DataProxy.getDataForArea(Application.selectedUnit,t,Application.filtersString);else{Map.updateMapLayer();Tabulky.updatePeriod(null);Porovnani.updatePeriodAndFilters(null,e);Preloader.hide()}},50)},updateFilters:function(){Preloader.show();setTimeout(function(){function e(e){Map.updateMapLayer();Homepage.update(e);Porovnani.isDisplayed()&&Porovnani.updatePeriodAndFilters(e,t);Preloader.hide();Tabulky.updateFilters(t)}var t=DataProxy.getNamesAndIndexes(Application.zoomLevel),n=DataProxy.getTimeline();Timeline.update(n);DateModel.init();if(Application.selectedUnit>-1)DataProxy.getDataForArea(Application.selectedUnit,e,Application.filtersString);else{Map.updateMapLayer();Porovnani.updatePeriodAndFilters(null,t);Preloader.hide();Tabulky.updateFilters(t)}},50)},updateCustomCrime:function(e,t){this.customCrime={type:e,name:t};FilterBox.updateCustomCrime(this.customCrime.type,this.customCrime.name);Porovnani.inited&&Porovnani.updateCustomCrime(this.customCrime.type,this.customCrime.name);Tabulky.inited&&Tabulky.updateCustomCrime(this.customCrime.type,this.customCrime.name)},currentKey:function(){return Application.zoomLevel+","+Application.selectedPeriod+","+Application.filtersString()},filtersString:function(){var e="";len=Application.filters.length,i=0;for(i=0;i<len;i++){var t=Application.filters[i],n=t.indexOf(",");e+="'"+t+"'";i<len-1&&(e+=",")}e==""&&(e="-999");return e}};window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){var t=arguments,n;t.callee=t.callee.caller;n=[].slice.call(t);typeof console.log=="object"?log.apply.call(console.log,console,n):console.log.apply(console,n)}};(function(e){function t(){}for(var n="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),r;!!(r=n.pop());)e[r]=e[r]||t})(function(){try{console.log();return window.console}catch(e){return window.console={}}}());(function(){Application.init();$(window).keydown(function(e){e.keyCode==32&&e.target.nodeName!="INPUT"&&e.preventDefault()});var e=getURLParameter("test");if(e>0){console.log("run test");Tester.init()}})();